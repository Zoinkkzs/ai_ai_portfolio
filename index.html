<!DOCTYPE html>
<html lang="en" class="dark scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Thanh Huy - Portfolio</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet" />

    <!-- React Dependencies (UMD) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Three.js Dependencies (Using consistent unpkg versioning) -->
    <script crossorigin src="https://unpkg.com/three@0.128.0/build/three.min.js"></script>
    <script crossorigin src="https://unpkg.com/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#06bcf9", // Neon Blue
                        "secondary": "#a855f7", // Neon Purple
                        "background-light": "#f5f8f8",
                        "background-dark": "#0a1116", // Deep navy/midnight start
                        "void": "#020204", // Deep space black
                        "surface-dark": "#111820",
                    },
                    fontFamily: {
                        "display": ["Space Grotesk", "sans-serif"],
                        "sans": ["Space Grotesk", "sans-serif"],
                    },
                    backgroundImage: {
                        'gradient-radial': 'radial-gradient(var(--tw-gradient-stops))',
                    },
                    boxShadow: {
                        "neon": "0 0 15px rgba(6, 188, 249, 0.3)",
                        "neon-hover": "0 0 25px rgba(6, 188, 249, 0.5)",
                        "neon-purple": "0 0 15px rgba(168, 85, 247, 0.3)",
                        "neon-purple-hover": "0 0 25px rgba(168, 85, 247, 0.6)",
                    }
                },
            },
        }
    </script>
    <style>
        .range-slider {
            -webkit-appearance: none;
            width: 100%;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            outline: none;
        }
        .range-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #06bcf9;
            cursor: pointer;
            box-shadow: 0 0 10px #06bcf9;
            transition: all 0.2s;
        }
        .range-slider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            background: #fff;
            box-shadow: 0 0 15px #fff, 0 0 30px #06bcf9;
        }
        /* Gradient Slider Track for Temp */
        .temp-slider::-webkit-slider-runnable-track {
            background: linear-gradient(to right, #ef4444, #f97316, #eab308, #ffffff, #3b82f6);
            height: 4px;
            border-radius: 2px;
        }
        
        .molecule-scroll::-webkit-scrollbar {
            width: 6px;
        }
        .molecule-scroll::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }
        .molecule-scroll::-webkit-scrollbar-thumb {
            background: #06bcf9;
            border-radius: 3px;
        }
        
        .particle-input {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 4px;
            color: #06bcf9;
            font-family: monospace;
            padding: 4px 8px;
            width: 80px;
            font-size: 0.8rem;
            transition: all 0.2s;
            text-align: center;
        }
        .particle-input:focus {
            outline: none;
            border-color: #06bcf9;
            background: rgba(6, 188, 249, 0.1);
        }
        .equation-input {
            background: transparent;
            border-bottom: 2px solid #334155;
            color: white;
            text-align: center;
            font-family: 'Space Grotesk', monospace;
            transition: border-color 0.2s;
        }
        .equation-input:focus {
            outline: none;
            border-color: #06bcf9;
        }
    </style>
  </head>
  <body class="bg-background-light dark:bg-background-dark text-[#101e23] dark:text-white antialiased selection:bg-secondary selection:text-white font-display">
    <div id="root"></div>

    <!-- Main Application Logic -->
    <script type="text/babel">
      const { useState, useEffect, useRef, useMemo } = React;

      // --- Constants & Types ---

      const GITHUB_USERNAME = "Zoinkkzs"; 
      const PROFILE_AVATAR = `https://littleastronomy.com/wp-content/uploads/2023/01/what-are-pulsars-and-how-are-they-formed.jpg`;

      const NAV_ITEMS = [
        { label: 'Home', href: '#home' },
        { label: 'Work', href: '#projects' },
        { label: 'About', href: '#about' },
        { label: 'Contact', href: '#contact' },
      ];

      const PROJECTS = [
        {
          id: 'decay',
          title: 'Decay Challenge',
          category: 'Nuclear Physics',
          description: 'Interactive nuclear decay simulator. Balance equations and visualize alpha, beta, and gamma radiation in 3D.',
          image: 'https://images.unsplash.com/photo-1628151015968-3a44118d8d0f?q=80&w=1000&auto=format&fit=crop',
          tags: ['React', 'Three.js'],
          color: 'secondary',
          url: '#'
        },
        {
          id: 'molecular',
          title: 'Molecular Bonds',
          category: 'Chemistry',
          description: 'Educational platform featuring minimalist 3D structure and covalent bond visualizations.',
          image: 'https://images.unsplash.com/photo-1532094349884-543bc11b234d?q=80&w=1000&auto=format&fit=crop',
          tags: ['WebGL', 'D3.js'],
          color: 'primary',
          url: '#'
        },
        {
          id: 'eclipse',
          title: 'Solar Eclipse Simulation',
          category: 'Astrophysics',
          description: 'Real-time solar eclipse simulation with adjustable orbital mechanics, stellar temperature, and planetary alignment.',
          image: 'https://images.unsplash.com/photo-1532693322450-2cb5c511067d?q=80&w=1000&auto=format&fit=crop',
          tags: ['Astrophysics', 'Simulation'],
          color: 'secondary',
          url: '#'
        }
      ];

      const TECH_STACK = [
        { icon: 'terminal', title: 'Coding', desc: 'Lua, C++', color: 'text-primary' },
        { icon: 'hexagon', title: 'Science', desc: 'Chem, Physics, Mathematics', color: 'text-secondary' },
        { icon: 'database', title: 'Data', desc: 'Python, Java', color: 'text-secondary' },
        { icon: 'palette', title: 'Other Skills', desc: 'Chess, Drawing', color: 'text-primary' },
      ];

      const ISOTOPES = [
        { name: "Carbon-14", symbol: "C", mass: 14, atomic: 6, type: "Beta Minus", product: { mass: 14, atomic: 7, symbol: "N" }, particles: ["β⁻", "ν̄"] },
        { name: "Tritium", symbol: "H", mass: 3, atomic: 1, type: "Beta Minus", product: { mass: 3, atomic: 2, symbol: "He" }, particles: ["β⁻", "ν̄"] },
        { name: "Potassium-40", symbol: "K", mass: 40, atomic: 19, type: "Beta Minus", product: { mass: 40, atomic: 20, symbol: "Ca" }, particles: ["β⁻", "ν̄"] },
        { name: "Uranium-238", symbol: "U", mass: 238, atomic: 92, type: "Alpha", product: { mass: 234, atomic: 90, symbol: "Th" }, particles: [] },
        { name: "Uranium-235", symbol: "U", mass: 235, atomic: 92, type: "Alpha", product: { mass: 231, atomic: 90, symbol: "Th" }, particles: [] },
        { name: "Thorium-232", symbol: "Th", mass: 232, atomic: 90, type: "Alpha", product: { mass: 228, atomic: 88, symbol: "Ra" }, particles: [] },
        { name: "Radium-226", symbol: "Ra", mass: 226, atomic: 88, type: "Alpha", product: { mass: 222, atomic: 86, symbol: "Rn" }, particles: [] },
        { name: "Radon-222", symbol: "Rn", mass: 222, atomic: 86, type: "Alpha", product: { mass: 218, atomic: 84, symbol: "Po" }, particles: [] },
        { name: "Polonium-210", symbol: "Po", mass: 210, atomic: 84, type: "Alpha", product: { mass: 206, atomic: 82, symbol: "Pb" }, particles: [] },
        { name: "Lead-210", symbol: "Pb", mass: 210, atomic: 82, type: "Beta Minus", product: { mass: 210, atomic: 83, symbol: "Bi" }, particles: ["β⁻", "ν̄"] },
        { name: "Iodine-131", symbol: "I", mass: 131, atomic: 53, type: "Beta Minus", product: { mass: 131, atomic: 54, symbol: "Xe" }, particles: ["β⁻", "ν̄"] },
        { name: "Technetium-99m", symbol: "Tc", mass: 99, atomic: 43, type: "Gamma", product: { mass: 99, atomic: 43, symbol: "Tc" }, particles: ["γ"] },
        { name: "Cobalt-60", symbol: "Co", mass: 60, atomic: 27, type: "Beta Minus", product: { mass: 60, atomic: 28, symbol: "Ni" }, particles: ["β⁻", "γ", "ν̄"] },
        { name: "Cesium-137", symbol: "Cs", mass: 137, atomic: 55, type: "Beta Minus", product: { mass: 137, atomic: 56, symbol: "Ba" }, particles: ["β⁻", "ν̄"] },
        { name: "Strontium-90", symbol: "Sr", mass: 90, atomic: 38, type: "Beta Minus", product: { mass: 90, atomic: 39, symbol: "Y" }, particles: ["β⁻", "ν̄"] },
        { name: "Americium-241", symbol: "Am", mass: 241, atomic: 95, type: "Alpha", product: { mass: 237, atomic: 93, symbol: "Np" }, particles: [] },
        { name: "Plutonium-239", symbol: "Pu", mass: 239, atomic: 94, type: "Alpha", product: { mass: 235, atomic: 92, symbol: "U" }, particles: [] },
        { name: "Neptunium-237", symbol: "Np", mass: 237, atomic: 93, type: "Alpha", product: { mass: 233, atomic: 91, symbol: "Pa" }, particles: [] },
        { name: "Krypton-85", symbol: "Kr", mass: 85, atomic: 36, type: "Beta Minus", product: { mass: 85, atomic: 37, symbol: "Rb" }, particles: ["β⁻", "ν̄"] },
        { name: "Sodium-24", symbol: "Na", mass: 24, atomic: 11, type: "Beta Minus", product: { mass: 24, atomic: 12, symbol: "Mg" }, particles: ["β⁻", "γ", "ν̄"] },
        { name: "Beryllium-7", symbol: "Be", mass: 7, atomic: 4, type: "Electron Capture", product: { mass: 7, atomic: 3, symbol: "Li" }, particles: ["ν"] },
        { name: "Rubidium-87", symbol: "Rb", mass: 87, atomic: 37, type: "Beta Minus", product: { mass: 87, atomic: 38, symbol: "Sr" }, particles: ["β⁻", "ν̄"] },
        { name: "Californium-252", symbol: "Cf", mass: 252, atomic: 98, type: "Alpha", product: { mass: 248, atomic: 96, symbol: "Cm" }, particles: [] },
        { name: "Oganesson-294", symbol: "Og", mass: 294, atomic: 118, type: "Alpha", product: { mass: 290, atomic: 116, symbol: "Lv" }, particles: [] }
      ];

      const SHELL_CONFIGS = {
        1: [1], 4: [2, 2], 6: [2, 4], 11: [2, 8, 1], 19: [2, 8, 8, 1], 
        27: [2, 8, 15, 2], 36: [2, 8, 18, 8], 37: [2, 8, 18, 8, 1], 
        38: [2, 8, 18, 8, 2], 43: [2, 8, 18, 13, 2], 53: [2, 8, 18, 18, 7], 
        55: [2, 8, 18, 18, 8, 1], 82: [2, 8, 18, 32, 18, 4], 84: [2, 8, 18, 32, 18, 6], 
        86: [2, 8, 18, 32, 18, 8], 88: [2, 8, 18, 32, 18, 8, 2], 90: [2, 8, 18, 32, 18, 10, 2], 
        92: [2, 8, 18, 32, 21, 9, 2], 93: [2, 8, 18, 32, 22, 9, 2], 94: [2, 8, 18, 32, 24, 8, 2], 
        95: [2, 8, 18, 32, 25, 8, 2], 98: [2, 8, 18, 32, 28, 8, 2], 118: [2, 8, 18, 32, 32, 18, 8]
      };

      const getElectronShells = (z) => {
          if (SHELL_CONFIGS[z]) return SHELL_CONFIGS[z];
          const shells = [];
          let remaining = z;
          const caps = [2, 8, 18, 32, 50, 72, 98];
          for(let cap of caps) {
              if (remaining <= 0) break;
              let take = Math.min(remaining, cap);
              shells.push(take);
              remaining -= take;
          }
          return shells;
      };

      const PARTICLES = ["α", "β⁻", "γ", "ν", "ν̄", "e⁻"];

      const MOLECULES = {
        "Benzene": { atoms: [{id:0,el:"C",x:1.4,y:0,z:0},{id:1,el:"C",x:0.7,y:1.21,z:0},{id:2,el:"C",x:-0.7,y:1.21,z:0},{id:3,el:"C",x:-1.4,y:0,z:0},{id:4,el:"C",x:-0.7,y:-1.21,z:0},{id:5,el:"C",x:0.7,y:-1.21,z:0},{id:6,el:"H",x:2.4,y:0,z:0},{id:7,el:"H",x:1.2,y:2.1,z:0},{id:8,el:"H",x:-1.2,y:2.1,z:0},{id:9,el:"H",x:-2.4,y:0,z:0},{id:10,el:"H",x:-1.2,y:-2.1,z:0},{id:11,el:"H",x:1.2,y:-2.1,z:0}], bonds: [{source:0,target:1,type:"double"},{source:1,target:2,type:"single"},{source:2,target:3,type:"double"},{source:3,target:4,type:"single"},{source:4,target:5,type:"double"},{source:5,target:0,type:"single"},{source:0,target:6,type:"single"},{source:1,target:7,type:"single"},{source:2,target:8,type:"single"},{source:3,target:9,type:"single"},{source:4,target:10,type:"single"},{source:5,target:11,type:"single"}] },
        "Water": { atoms: [{id:0,el:"O",x:0,y:0,z:0.1},{id:1,el:"H",x:0.8,y:-0.6,z:0},{id:2,el:"H",x:-0.8,y:-0.6,z:0}], bonds: [{source:0,target:1,type:"single"},{source:0,target:2,type:"single"}] },
        "Methanol": { atoms: [{id:0,el:"C",x:-0.7,y:0,z:0},{id:1,el:"C",x:0.7,y:0,z:0},{id:2,el:"H",x:-1.0,y:1.0,z:0},{id:3,el:"H",x:-1.0,y:-0.5,z:0.9},{id:4,el:"H",x:-1.0,y:-0.5,z:-0.9},{id:5,el:"H",x:1.2,y:-0.8,z:0}], bonds: [{source:0,target:1,type:"single"},{source:0,target:2,type:"single"},{source:0,target:3,type:"single"},{source:0,target:4,type:"single"},{source:1,target:5,type:"single"}] },
        "Ethanol": { atoms: [{id:0,el:"C",x:-1.2,y:0,z:0},{id:1,el:"C",x:0,y:0.5,z:0},{id:2,el:"O",x:1.2,y:-0.2,z:0},{id:3,el:"H",x:1.8,y:0.5,z:0},{id:4,el:"H",x:-1.2,y:-1.1,z:0},{id:5,el:"H",x:-2.1,y:0.4,z:0},{id:6,el:"H",x:-1.2,y:0.4,z:1.0},{id:7,el:"H",x:0,y:1.6,z:0},{id:8,el:"H",x:0,y:0.1,z:-1.0}], bonds: [{source:0,target:1,type:"single"},{source:1,target:2,type:"single"},{source:2,target:3,type:"single"},{source:0,target:4,type:"single"},{source:0,target:5,type:"single"},{source:0,target:6,type:"single"},{source:1,target:7,type:"single"},{source:1,target:8,type:"single"}] },
        "Acetic Acid": { atoms: [{id:0,el:"C",x:-1.0,y:0,z:0},{id:1,el:"C",x:0.5,y:0,z:0},{id:2,el:"O",x:1.2,y:1.2,z:0},{id:3,el:"O",x:1.1,y:-1.2,z:0},{id:4,el:"H",x:0.5,y:-1.8,z:0},{id:5,el:"H",x:-1.4,y:1.0,z:0},{id:6,el:"H",x:-1.4,y:-0.5,z:0.9},{id:7,el:"H",x:-1.4,y:-0.5,z:-0.9}], bonds: [{source:0,target:1,type:"single"},{source:1,target:2,type:"double"},{source:1,target:3,type:"single"},{source:3,target:4,type:"single"},{source:0,target:5,type:"single"},{source:0,target:6,type:"single"},{source:0,target:7,type:"single"}] },
        "Butadiene": { atoms: [{id:0,el:"C",x:-2,y:-0.5,z:0},{id:1,el:"C",x:-0.7,y:0.5,z:0},{id:2,el:"C",x:0.7,y:-0.5,z:0},{id:3,el:"C",x:2,y:0.5,z:0},{id:4,el:"H",x:-2,y:-1.6,z:0},{id:5,el:"H",x:-2.9,y:0.05,z:0},{id:6,el:"H",x:-0.7,y:1.6,z:0},{id:7,el:"H",x:0.7,y:-1.6,z:0},{id:8,el:"H",x:2,y:1.6,z:0},{id:9,el:"H",x:2.9,y:-0.05,z:0}], bonds: [{source:0,target:1,type:"double"},{source:1,target:2,type:"single"},{source:2,target:3,type:"double"},{source:0,target:4,type:"single"},{source:0,target:5,type:"single"},{source:1,target:6,type:"single"},{source:2,target:7,type:"single"},{source:3,target:8,type:"single"},{source:3,target:9,type:"single"}] },
        "Cyclohexane": { atoms: [{id:0,el:"C",x:1.4,y:0.5,z:-0.2},{id:1,el:"C",x:0.7,y:-0.7,z:0.2},{id:2,el:"C",x:-0.7,y:-0.7,z:-0.2},{id:3,el:"C",x:-1.4,y:0.5,z:0.2},{id:4,el:"C",x:-0.7,y:1.7,z:-0.2},{id:5,el:"C",x:0.7,y:1.7,z:0.2},{id:6,el:"H",x:1.4,y:0.5,z:-1.3},{id:7,el:"H",x:2.4,y:0.5,z:0.2},{id:8,el:"H",x:0.7,y:-0.7,z:1.3},{id:9,el:"H",x:1.2,y:-1.6,z:-0.2},{id:10,el:"H",x:-0.7,y:-0.7,z:-1.3},{id:11,el:"H",x:-1.2,y:-1.6,z:0.2},{id:12,el:"H",x:-1.4,y:0.5,z:1.3},{id:13,el:"H",x:-2.4,y:0.5,z:-0.2},{id:14,el:"H",x:-0.7,y:1.7,z:-1.3},{id:15,el:"H",x:-1.2,y:2.6,z:0.2},{id:16,el:"H",x:0.7,y:1.7,z:1.3},{id:17,el:"H",x:1.2,y:2.6,z:-0.2}], bonds: [{source:0,target:1,type:"single"},{source:1,target:2,type:"single"},{source:2,target:3,type:"single"},{source:3,target:4,type:"single"},{source:4,target:5,type:"single"},{source:5,target:0,type:"single"},{source:0,target:6,type:"single"},{source:0,target:7,type:"single"},{source:1,target:8,type:"single"},{source:1,target:9,type:"single"},{source:2,target:10,type:"single"},{source:2,target:11,type:"single"},{source:3,target:12,type:"single"},{source:3,target:13,type:"single"},{source:4,target:14,type:"single"},{source:4,target:15,type:"single"},{source:5,target:16,type:"single"},{source:5,target:17,type:"single"}] },
        "Xenon": { atoms: [{id:0,el:"Xe",x:-2.0,y:0,z:0},{id:1,el:"Xe",x:2.0,y:0,z:0}], bonds: [{source:0,target:1,type:"vdw"}] },
        "Benzaldehyde": { atoms: [{id:0,el:"C",x:1.4,y:0,z:0},{id:1,el:"C",x:0.7,y:1.21,z:0},{id:2,el:"C",x:-0.7,y:1.21,z:0},{id:3,el:"C",x:-1.4,y:0,z:0},{id:4,el:"C",x:-0.7,y:-1.21,z:0},{id:5,el:"C",x:0.7,y:-1.21,z:0},{id:6,el:"C",x:-2.8,y:0,z:0},{id:7,el:"O",x:-3.5,y:1.2,z:0},{id:8,el:"H",x:-3.3,y:-1.0,z:0}], bonds: [{source:0,target:1,type:"double"},{source:1,target:2,type:"single"},{source:2,target:3,type:"double"},{source:3,target:4,type:"single"},{source:4,target:5,type:"double"},{source:5,target:0,type:"single"},{source:3,target:6,type:"single"},{source:6,target:7,type:"double"},{source:6,target:8,type:"single"}] },
        "Sodium Acetate": { atoms: [{id:0,el:"C",x:-1.0,y:0,z:0},{id:1,el:"C",x:0.5,y:0,z:0},{id:2,el:"O",x:1.2,y:1.2,z:0},{id:3,el:"O",x:1.1,y:-1.2,z:0,role:"anion"},{id:4,el:"Na",x:3.5,y:-1.5,z:0,role:"cation"},{id:5,el:"H",x:-1.4,y:1.0,z:0},{id:6,el:"H",x:-1.4,y:-0.5,z:0.9},{id:7,el:"H",x:-1.4,y:-0.5,z:-0.9}], bonds: [{source:0,target:1,type:"single"},{source:1,target:2,type:"double"},{source:1,target:3,type:"single"},{source:0,target:5,type:"single"},{source:0,target:6,type:"single"},{source:0,target:7,type:"single"},{source:3,target:4,type:"ionic"}] },
        "Tollen's Reagent": { atoms: [{id:0,el:"Ag",x:0,y:0,z:0,role:"cation"},{id:1,el:"N",x:-2.1,y:0,z:0},{id:2,el:"N",x:2.1,y:0,z:0},{id:3,el:"H",x:-2.5,y:0.8,z:0},{id:4,el:"H",x:-2.5,y:-0.4,z:0.7},{id:5,el:"H",x:-2.5,y:-0.4,z:-0.7},{id:6,el:"H",x:2.5,y:0.8,z:0},{id:7,el:"H",x:2.5,y:-0.4,z:0.7},{id:8,el:"H",x:2.5,y:-0.4,z:-0.7}], bonds: [{source:0,target:1,type:"single"},{source:0,target:2,type:"single"},{source:1,target:3,type:"single"},{source:1,target:4,type:"single"},{source:1,target:5,type:"single"},{source:2,target:6,type:"single"},{source:2,target:7,type:"single"},{source:2,target:8,type:"single"}] },
        "Dextrose": { atoms: [{id:0,el:"C",x:0,y:3,z:0},{id:1,el:"O",x:1.2,y:3.5,z:0},{id:2,el:"C",x:0,y:1.5,z:0},{id:3,el:"O",x:-1.4,y:1.5,z:0},{id:4,el:"C",x:0,y:0,z:0},{id:5,el:"O",x:1.4,y:0,z:0},{id:6,el:"C",x:0,y:-1.5,z:0},{id:7,el:"O",x:-1.4,y:-1.5,z:0},{id:8,el:"C",x:0,y:-3,z:0},{id:9,el:"O",x:1.4,y:-3,z:0},{id:10,el:"C",x:0,y:-4.5,z:0},{id:11,el:"O",x:0,y:-5.5,z:0},{id:12,el:"H",x:-1.0,y:3.2,z:0},{id:13,el:"H",x:1.0,y:1.5,z:0},{id:14,el:"H",x:-2.0,y:2.0,z:0},{id:15,el:"H",x:-1.0,y:0,z:0},{id:16,el:"H",x:2.0,y:0.5,z:0},{id:17,el:"H",x:1.0,y:-1.5,z:0},{id:18,el:"H",x:-2.0,y:-1.0,z:0},{id:19,el:"H",x:-1.0,y:-3,z:0},{id:20,el:"H",x:2.0,y:-2.5,z:0},{id:21,el:"H",x:-1.0,y:-4.5,z:0.5},{id:22,el:"H",x:1.0,y:-4.5,z:-0.5},{id:23,el:"H",x:0.5,y:-6.0,z:0}], bonds: [{source:0,target:1,type:"double"},{source:0,target:2,type:"single"},{source:0,target:12,type:"single"},{source:2,target:3,type:"single"},{source:2,target:4,type:"single"},{source:2,target:13,type:"single"},{source:3,target:14,type:"single"},{source:4,target:5,type:"single"},{source:4,target:6,type:"single"},{source:4,target:15,type:"single"},{source:5,target:16,type:"single"},{source:6,target:7,type:"single"},{source:6,target:8,type:"single"},{source:6,target:17,type:"single"},{source:7,target:18,type:"single"},{source:8,target:9,type:"single"},{source:8,target:10,type:"single"},{source:8,target:19,type:"single"},{source:9,target:20,type:"single"},{source:10,target:11,type:"single"},{source:10,target:21,type:"single"},{source:10,target:22,type:"single"},{source:11,target:23,type:"single"}] },
        "Glucopyranose": { atoms: [{id:0,el:"O",x:1.2,y:0.7,z:0},{id:1,el:"C",x:1.2,y:-0.7,z:0},{id:2,el:"C",x:0,y:-1.4,z:0},{id:3,el:"C",x:-1.2,y:-0.7,z:0},{id:4,el:"C",x:-1.2,y:0.7,z:0},{id:5,el:"C",x:0,y:1.4,z:0},{id:6,el:"C",x:0,y:2.8,z:0},{id:7,el:"O",x:1.2,y:2.8,z:0},{id:8,el:"O",x:2.3,y:-1.0,z:0},{id:9,el:"O",x:0,y:-2.6,z:0},{id:10,el:"O",x:-2.3,y:-1.0,z:0},{id:11,el:"O",x:-2.3,y:1.0,z:0},{id:12,el:"H",x:2.8,y:-0.5,z:0},{id:13,el:"H",x:0.5,y:-3.0,z:0},{id:14,el:"H",x:-2.8,y:-0.5,z:0},{id:15,el:"H",x:-2.8,y:1.5,z:0},{id:16,el:"H",x:1.8,y:3.2,z:0},{id:17,el:"H",x:0.5,y:-0.5,z:1.0},{id:18,el:"H",x:-0.5,y:-1.0,z:1.0},{id:19,el:"H",x:-0.8,y:-0.5,z:1.0},{id:20,el:"H",x:-0.8,y:0.5,z:1.0},{id:21,el:"H",x:0,y:1.2,z:1.2},{id:22,el:"H",x:-0.8,y:2.8,z:0.5},{id:23,el:"H",x:0.5,y:2.8,z:-0.8}], bonds: [{source:0,target:1,type:"single"},{source:1,target:2,type:"single"},{source:2,target:3,type:"single"},{source:3,target:4,type:"single"},{source:4,target:5,type:"single"},{source:5,target:0,type:"single"},{source:5,target:6,type:"single"},{source:6,target:7,type:"single"},{source:1,target:8,type:"single"},{source:8,target:12,type:"single"},{source:2,target:9,type:"single"},{source:9,target:13,type:"single"},{source:3,target:10,type:"single"},{source:10,target:14,type:"single"},{source:4,target:11,type:"single"},{source:11,target:15,type:"single"},{source:7,target:16,type:"single"},{source:1,target:17,type:"single"},{source:2,target:18,type:"single"},{source:3,target:19,type:"single"},{source:4,target:20,type:"single"},{source:5,target:21,type:"single"},{source:6,target:22,type:"single"},{source:6,target:23,type:"single"}] }
      };

      const ATOMIC_MASSES = {
        "H": 1.008, "C": 12.011, "N": 14.007, "O": 15.999, "Na": 22.990, "Ag": 107.868, "Xe": 131.293
      };
      
      const ELEMENT_COLORS = {
        "C": 0x333333, "H": 0xFFFFFF, "O": 0xFF0000, "N": 0x0000FF, 
        "Ag": 0xC0C0C0, "Na": 0x800080, "Xe": 0x00FFFF
      };

      const ELEMENT_RADII = {
        "C": 0.4, "H": 0.25, "O": 0.35, "N": 0.38, "Ag": 0.5, "Na": 0.5, "Xe": 0.5
      };

      const GradientText = ({ children }) => (
        <span className="text-transparent bg-clip-text bg-gradient-to-r from-primary via-cyan-300 to-secondary font-bold">
            {children}
        </span>
      );

      const ShootingStars = () => {
        const canvasRef = useRef(null);
        useEffect(() => {
          const canvas = canvasRef.current;
          const ctx = canvas.getContext('2d');
          let width, height;
          let stars = [];
          let shootingStars = [];

          const resize = () => {
            width = canvas.width = canvas.offsetWidth;
            height = canvas.height = canvas.offsetHeight;
            stars = Array.from({ length: 200 }, () => ({
              x: Math.random() * width,
              y: Math.random() * height,
              size: Math.random() * 2,
              alpha: Math.random()
            }));
          };
          window.addEventListener('resize', resize);
          resize();

          const createShootingStar = () => {
            const startX = Math.random() * width;
            const startY = Math.random() * height * 0.5;
            const length = Math.random() * 100 + 50;
            const angle = Math.PI / 4; 
            const speed = Math.random() * 10 + 5;
            return { x: startX, y: startY, length, angle, speed, life: 1, opacity: 1 };
          };

          const animate = () => {
              ctx.clearRect(0, 0, width, height);
              stars.forEach(star => {
                  ctx.fillStyle = `rgba(255, 255, 255, ${star.alpha})`;
                  ctx.beginPath();
                  ctx.arc(star.x, star.y, star.size, 0, Math.PI * 2);
                  ctx.fill();
              });
              if (Math.random() < 0.02) shootingStars.push(createShootingStar());
              shootingStars.forEach((star, index) => {
                  star.x -= star.speed; 
                  star.y += star.speed; 
                  star.life -= 0.02;
                  if (star.life <= 0) {
                      shootingStars.splice(index, 1);
                  } else {
                      const tailX = star.x + Math.cos(star.angle) * star.length;
                      const tailY = star.y - Math.sin(star.angle) * star.length;
                      const grad = ctx.createLinearGradient(star.x, star.y, tailX, tailY);
                      grad.addColorStop(0, `rgba(255, 255, 255, ${star.life})`);
                      grad.addColorStop(1, 'rgba(255, 255, 255, 0)');
                      ctx.strokeStyle = grad;
                      ctx.lineWidth = 2;
                      ctx.beginPath();
                      ctx.moveTo(star.x, star.y);
                      ctx.lineTo(tailX, tailY);
                      ctx.stroke();
                  }
              });
              requestAnimationFrame(animate);
          };
          const animId = requestAnimationFrame(animate);
          return () => {
              window.removeEventListener('resize', resize);
              cancelAnimationFrame(animId);
          };
        }, []);
        return <canvas ref={canvasRef} className="absolute inset-0 w-full h-full" />;
      };

      const DecayChallenge = ({ onClose }) => {
        const mountRef = useRef(null);
        const [selectedIsotope, setSelectedIsotope] = useState(ISOTOPES[0]);
        const [searchTerm, setSearchTerm] = useState("");
        const filteredIsotopes = useMemo(() => ISOTOPES.filter(iso => iso.name.toLowerCase().includes(searchTerm.toLowerCase()) || iso.symbol.toLowerCase().includes(searchTerm.toLowerCase())), [searchTerm]);
        const [productMain, setProductMain] = useState({ mass: "", atomic: "", symbol: "" });
        const [productSec, setProductSec] = useState({ mass: "", atomic: "", symbol: "" });
        const [particleInputLeft, setParticleInputLeft] = useState("");
        const [particleInputRight, setParticleInputRight] = useState("");
        const [status, setStatus] = useState("idle"); 
        const [animProgress, setAnimProgress] = useState(0); 
        const [isPlaying, setIsPlaying] = useState(false);
        const simState = useRef({ progress: 0, isPlaying: false, decayType: "Beta Minus" });

        useEffect(() => { simState.current.isPlaying = isPlaying; simState.current.decayType = selectedIsotope.type; if(!isPlaying) simState.current.progress = animProgress; }, [isPlaying, animProgress, selectedIsotope]);

        const parseParticles = (input) => input.trim().split(/[\s,]+/).map(t => { const val = t.toLowerCase(); if (val === 'b-' || val === 'beta') return 'β⁻'; if (val === 'y' || val === 'gamma') return 'γ'; if (val === 'v' || val === 'nu') return 'ν'; if (val === 'v-' || val === 'nu-') return 'ν̄'; if (val === 'a' || val === 'alpha') return 'α'; if (val === 'e' || val === 'e-') return 'e⁻'; return ''; }).filter(t => t);

        const checkAnswer = () => {
            const correctProd = selectedIsotope.product;
            const type = selectedIsotope.type;
            const isMainCorrect = parseInt(productMain.mass) === correctProd.mass && parseInt(productMain.atomic) === correctProd.atomic && productMain.symbol.toLowerCase().trim() === correctProd.symbol.toLowerCase();
            let isSecProdCorrect = false;
            if (type === "Alpha") { const sym = productSec.symbol.toLowerCase().trim(); const validAlphaSyms = ['he', 'he++', 'he2+', 'α']; isSecProdCorrect = productSec.mass === "4" && productSec.atomic === "2" && validAlphaSyms.includes(sym); } else { isSecProdCorrect = productSec.mass === "" && productSec.atomic === "" && productSec.symbol === ""; }
            const leftTokens = parseParticles(particleInputLeft);
            let isLeftCorrect = type === "Electron Capture" ? leftTokens.includes('e⁻') : leftTokens.length === 0;
            const rightTokens = parseParticles(particleInputRight);
            const expectedRight = [...selectedIsotope.particles];
            const normalize = (list) => list.map(p => p === 'e⁻' ? 'β⁻' : p).sort();
            const isRightCorrect = JSON.stringify(normalize(rightTokens)) === JSON.stringify(normalize(expectedRight));
            if (isMainCorrect && isLeftCorrect && isSecProdCorrect && isRightCorrect) { setStatus("correct"); setIsPlaying(true); } else { setStatus("wrong"); }
        };
        
        useEffect(() => { setProductMain({ mass: "", atomic: "", symbol: "" }); setProductSec({ mass: "", atomic: "", symbol: "" }); setParticleInputLeft(""); setParticleInputRight(""); setStatus("idle"); setAnimProgress(0); setIsPlaying(false); simState.current.progress = 0; }, [selectedIsotope]);
        
        useEffect(() => {
            if (!mountRef.current || !window.THREE) return;
            const width = mountRef.current.clientWidth; const height = mountRef.current.clientHeight;
            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(45, width / height, 0.1, 100); camera.position.set(0, 5, 10);
            const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true }); renderer.setSize(width, height); mountRef.current.appendChild(renderer.domElement);
            const controls = new THREE.OrbitControls(camera, renderer.domElement); controls.enableDamping = true; controls.dampingFactor = 0.05; controls.enablePan = true;
            const ambient = new THREE.AmbientLight(0x404040, 2); scene.add(ambient);
            const light = new THREE.DirectionalLight(0xffffff, 2); light.position.set(5, 5, 5); scene.add(light);
            const nucleusGroup = new THREE.Group(); scene.add(nucleusGroup);
            const electronGroup = new THREE.Group(); scene.add(electronGroup);
            const particleGroup = new THREE.Group(); scene.add(particleGroup);
            let protonMeshes = []; let capturedElectronMesh = null; let targetProton = null;

            const generateNucleus = () => {
                while(nucleusGroup.children.length > 0) nucleusGroup.remove(nucleusGroup.children[0]); protonMeshes = [];
                const protonCount = selectedIsotope.atomic; const neutronCount = selectedIsotope.mass - selectedIsotope.atomic;
                const total = selectedIsotope.mass; const scaleFactor = Math.min(1, 50 / total); 
                const visualProtons = Math.ceil(protonCount * scaleFactor); const visualNeutrons = Math.ceil(neutronCount * scaleFactor);
                const geometry = new THREE.SphereGeometry(0.4, 16, 16);
                const pMat = new THREE.MeshPhongMaterial({ color: 0xff3333, shininess: 80 }); const nMat = new THREE.MeshPhongMaterial({ color: 0xcccccc, shininess: 50 });
                const clusterRadius = Math.pow(visualProtons + visualNeutrons, 1/3) * 0.25;
                for(let i=0; i<visualProtons + visualNeutrons; i++) {
                    const isProton = i < visualProtons; const mesh = new THREE.Mesh(geometry, isProton ? pMat : nMat);
                    const r = Math.pow(Math.random(), 1/3) * clusterRadius; const theta = Math.random() * Math.PI * 2; const phi = Math.acos(2 * Math.random() - 1);
                    mesh.position.x = r * Math.sin(phi) * Math.cos(theta); mesh.position.y = r * Math.sin(phi) * Math.sin(theta); mesh.position.z = r * Math.cos(phi);
                    mesh.userData = { type: isProton ? 'proton' : 'neutron' }; nucleusGroup.add(mesh); if (isProton) protonMeshes.push(mesh);
                }
                if (protonMeshes.length > 0) targetProton = protonMeshes[protonMeshes.length - 1];
            };

            const generateElectrons = () => {
                while(electronGroup.children.length > 0) electronGroup.remove(electronGroup.children[0]);
                const shells = getElectronShells(selectedIsotope.atomic);
                shells.forEach((count, index) => {
                    if (count <= 0) return; const radius = 3 + index * 1.5;
                    const ring = new THREE.Mesh(new THREE.TorusGeometry(radius, 0.02, 8, 64), new THREE.MeshBasicMaterial({ color: 0x444444, opacity: 0.3, transparent: true }));
                    ring.rotation.x = Math.PI / 2 + (Math.random() - 0.5) * 0.5; ring.rotation.y += (Math.random() - 0.5) * 0.5; electronGroup.add(ring);
                    for(let i=0; i<count; i++) {
                        const angle = (i / count) * Math.PI * 2;
                        const el = new THREE.Mesh(new THREE.SphereGeometry(0.12, 8, 8), new THREE.MeshBasicMaterial({ color: 0x00ffff }));
                        el.position.set(Math.cos(angle) * radius, Math.sin(angle) * radius, 0);
                        const pivot = new THREE.Group(); pivot.rotation.copy(ring.rotation); pivot.add(el);
                        pivot.userData = { speed: (Math.random() * 0.05 + 0.02) * (index % 2 === 0 ? 1 : -1) }; electronGroup.add(pivot);
                        if (index === 0 && i === 0) capturedElectronMesh = el;
                    }
                });
            };
            generateNucleus(); generateElectrons();

            const particleGroupSetup = new THREE.Group(); scene.add(particleGroupSetup);

            let animId;
            const animate = () => {
                animId = requestAnimationFrame(animate); controls.update();
                electronGroup.children.forEach(pivot => { if (pivot.userData.speed) pivot.rotation.z += pivot.userData.speed; });
                const { isPlaying, progress } = simState.current;
                if (isPlaying && progress < 100) { simState.current.progress += 0.5; setAnimProgress(simState.current.progress); }
                renderer.render(scene, camera);
            };
            animate();
            return () => { cancelAnimationFrame(animId); if (mountRef.current && renderer) mountRef.current.removeChild(renderer.domElement); renderer.dispose(); };
        }, [selectedIsotope]);

        const updateState = (setter, field, value) => { setter(prev => ({ ...prev, [field]: value })); };

        return (
            <div className="fixed inset-0 z-[100] flex bg-[#0a1116] animate-in fade-in duration-300">
                <div className="w-72 border-r border-white/10 flex flex-col bg-surface-dark/95 backdrop-blur-md">
                    <div className="p-4 border-b border-white/10">
                        <button onClick={onClose} className="text-slate-400 hover:text-white flex items-center gap-2 text-sm mb-4"><span className="material-symbols-outlined text-sm">arrow_back</span> Back</button>
                        <h2 className="text-xl font-bold text-white"><span className="text-secondary">Decay</span> Challenge</h2>
                        <div className="relative mt-4"><span className="material-symbols-outlined absolute left-2 top-1/2 -translate-y-1/2 text-slate-500 text-xs">search</span><input type="text" placeholder="Search isotope..." value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} className="w-full bg-black/20 border border-white/10 rounded-md py-1.5 pl-8 pr-2 text-xs text-white focus:outline-none focus:border-secondary transition-colors"/></div>
                    </div>
                    <div className="flex-1 overflow-y-auto molecule-scroll p-2 space-y-1">
                        {filteredIsotopes.map((iso, idx) => (<button key={idx} onClick={() => setSelectedIsotope(iso)} className={`w-full text-left px-3 py-2 rounded text-sm flex justify-between items-center transition-colors ${selectedIsotope.name === iso.name ? 'bg-secondary/20 text-secondary border border-secondary/50' : 'text-slate-400 hover:bg-white/5 hover:text-white'}`}>{iso.name}<span className="text-[10px] font-mono opacity-50">{iso.type}</span></button>))}
                    </div>
                </div>
                <div className="flex-1 flex flex-col relative">
                    <div className="absolute top-0 left-0 w-full p-6 flex justify-between items-start pointer-events-none z-10"><div><h1 className="text-3xl font-bold text-white mb-1">{selectedIsotope.name}</h1><div className="flex items-center gap-2"><span className="px-2 py-1 bg-white/10 rounded text-xs font-mono text-white">Mass: {selectedIsotope.mass}</span><span className="px-2 py-1 bg-white/10 rounded text-xs font-mono text-white">Atomic: {selectedIsotope.atomic}</span></div></div><div className="bg-black/50 backdrop-blur px-4 py-2 rounded-lg border border-white/10 text-center"><span className="text-xs text-slate-400 uppercase tracking-widest">Decay Type</span><div className="text-xl font-bold text-primary">{selectedIsotope.type}</div></div></div>
                    <div ref={mountRef} className="flex-1 w-full bg-gradient-radial from-[#1a232e] to-[#020204]" />
                    <div className="h-56 bg-surface-dark border-t border-white/10 p-4 flex flex-col gap-4 overflow-x-auto">
                        <div className="flex items-center justify-center gap-2 sm:gap-4 text-white font-display flex-nowrap min-w-max px-4">
                            <div className="flex flex-col items-center leading-none"><span className="text-xs text-slate-400 border-b border-transparent">{selectedIsotope.mass}</span><span className="text-2xl font-bold">{selectedIsotope.symbol}</span><span className="text-xs text-slate-400">{selectedIsotope.atomic}</span></div>
                            <span className="text-slate-500">+</span><div className="flex flex-col items-center justify-center"><input className="particle-input" placeholder="e-" value={particleInputLeft} onChange={(e) => setParticleInputLeft(e.target.value)}/></div><span className="material-symbols-outlined text-slate-500 mx-2">arrow_forward</span>
                            <div className="flex flex-col items-center leading-none relative group"><input className="equation-input w-8 text-xs mb-1" placeholder="?" value={productMain.mass} onChange={(e) => updateState(setProductMain, 'mass', e.target.value)}/><input className="equation-input w-16 text-2xl font-bold mb-1" placeholder="?" value={productMain.symbol} onChange={(e) => updateState(setProductMain, 'symbol', e.target.value)}/><input className="equation-input w-8 text-xs" placeholder="?" value={productMain.atomic} onChange={(e) => updateState(setProductMain, 'atomic', e.target.value)}/></div>
                            <span className="text-slate-500">+</span><div className="flex flex-col items-center leading-none relative group"><input className="equation-input w-8 text-xs mb-1" placeholder="-" value={productSec.mass} onChange={(e) => updateState(setProductSec, 'mass', e.target.value)}/><input className="equation-input w-12 text-2xl font-bold mb-1" placeholder="?" value={productSec.symbol} onChange={(e) => updateState(setProductSec, 'symbol', e.target.value)}/><input className="equation-input w-8 text-xs" placeholder="-" value={productSec.atomic} onChange={(e) => updateState(setProductSec, 'atomic', e.target.value)}/></div>
                            <span className="text-slate-500">+</span><div className="flex flex-col items-center justify-center"><input className="particle-input" placeholder="B- v-" value={particleInputRight} onChange={(e) => setParticleInputRight(e.target.value)}/></div>
                            <button onClick={checkAnswer} className={`ml-4 px-4 py-2 rounded-full font-bold text-xs transition-all ${status === 'correct' ? 'bg-green-500 text-white' : 'bg-white text-black hover:bg-slate-200'}`}>{status === 'correct' ? 'SOLVED' : 'CHECK'}</button>
                        </div>
                        <div className="flex flex-col items-center gap-2"><div className={`text-sm font-bold h-5 ${status === 'correct' ? 'text-green-400' : status === 'wrong' ? 'text-red-400' : 'text-transparent'}`}>{status === 'correct' ? "Correct!" : "Try again."}</div></div>
                    </div>
                </div>
            </div>
        );
      };

      const MolecularViewer = ({ onClose }) => {
        // ... (Same Logic)
        const mountRef = useRef(null); const [selectedMoleculeName, setSelectedMoleculeName] = useState("Benzene"); const [searchQuery, setSearchQuery] = useState(""); const [showPi, setShowPi] = useState(false); const [showTau, setShowTau] = useState(false); const [showIonic, setShowIonic] = useState(true); const [showVDW, setShowVDW] = useState(true); const [error, setError] = useState(null); const raycaster = useRef(new THREE.Raycaster()); const atomWrappers = useRef([]); const atomMeshes = useRef([]); const moleculeList = useMemo(() => Object.keys(MOLECULES).filter(name => name.toLowerCase().includes(searchQuery.toLowerCase())), [searchQuery]); const moleculeInfo = useMemo(() => { const data = MOLECULES[selectedMoleculeName]; if (!data) return { formula: "", mass: 0 }; let mass = 0; const counts = {}; data.atoms.forEach(a => { counts[a.el] = (counts[a.el] || 0) + 1; mass += (ATOMIC_MASSES[a.el] || 0); }); let formula = ""; ["C", "H", "O", "N", "Na", "Ag", "Xe"].forEach(el => { if (counts[el]) formula += el + (counts[el] > 1 ? counts[el] : ""); }); return { formula, mass: mass.toFixed(2) }; }, [selectedMoleculeName]);
        
        useEffect(() => {
            if (!window.THREE) { setError("Three.js not loaded"); return; }
            if (!mountRef.current) return;
            const width = mountRef.current.clientWidth; const height = mountRef.current.clientHeight; const scene = new THREE.Scene(); scene.fog = new THREE.Fog(0x111111, 5, 25); const camera = new THREE.PerspectiveCamera(50, width / height, 0.1, 100); camera.position.z = 8; camera.position.y = 2; const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true }); renderer.setSize(width, height); mountRef.current.appendChild(renderer.domElement); const controls = new THREE.OrbitControls(camera, renderer.domElement); const ambientLight = new THREE.AmbientLight(0x404040, 2); scene.add(ambientLight); const pointLight = new THREE.PointLight(0xffffff, 1, 100); pointLight.position.set(10, 10, 10); scene.add(pointLight); const moleculeGroup = new THREE.Group(); scene.add(moleculeGroup);
            
            const renderMolecule = () => {
                while(moleculeGroup.children.length > 0) moleculeGroup.remove(moleculeGroup.children[0]); atomWrappers.current = []; atomMeshes.current = []; const data = MOLECULES[selectedMoleculeName]; if(!data) return;
                data.atoms.forEach(atom => { const radius = ELEMENT_RADII[atom.el] || 0.3; const color = ELEMENT_COLORS[atom.el] || 0xffffff; const sphere = new THREE.Mesh(new THREE.SphereGeometry(radius, 32, 32), new THREE.MeshPhysicalMaterial({ color: color, roughness: 0.3, metalness: 0.2 })); sphere.position.set(atom.x, atom.y, atom.z); moleculeGroup.add(sphere); atomMeshes.current.push(sphere); });
                data.bonds.forEach(bond => { 
                    const s = data.atoms[bond.source], t = data.atoms[bond.target]; const start = new THREE.Vector3(s.x, s.y, s.z), end = new THREE.Vector3(t.x, t.y, t.z); const dist = start.distanceTo(end), mid = new THREE.Vector3().addVectors(start, end).multiplyScalar(0.5);
                    const orient = new THREE.Matrix4().lookAt(start, end, new THREE.Object3D().up).multiply(new THREE.Matrix4().makeRotationX(Math.PI/2));
                    if (bond.type !== 'ionic' && bond.type !== 'vdw') { const cyl = new THREE.Mesh(new THREE.CylinderGeometry(0.1, 0.1, dist, 12), new THREE.MeshStandardMaterial({ color: 0x888888 })); cyl.applyMatrix4(orient); cyl.position.copy(mid); moleculeGroup.add(cyl); }
                });
            };
            renderMolecule();
            const animate = () => { requestAnimationFrame(animate); controls.update(); renderer.render(scene, camera); }; animate();
            return () => { if (mountRef.current && renderer) mountRef.current.removeChild(renderer.domElement); renderer.dispose(); };
        }, [selectedMoleculeName, showPi, showTau, showIonic, showVDW]);

        return (
            <div className="fixed inset-0 z-[100] flex bg-black/95 backdrop-blur-xl animate-in fade-in duration-300">
                <div className="w-80 border-r border-white/10 bg-[#0a0f14] flex flex-col p-6 z-10 shrink-0"><button onClick={onClose} className="mb-6 flex items-center gap-2 text-slate-400 hover:text-white transition-colors"><span className="material-symbols-outlined">arrow_back</span> Back</button><h2 className="text-2xl font-bold text-white mb-2">Molecular<br/><span className="text-primary">Viewer</span></h2><div className="relative mb-6"><span className="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-slate-500 text-sm">search</span><input type="text" placeholder="Search..." value={searchQuery} onChange={e => setSearchQuery(e.target.value)} className="w-full bg-black/50 border border-white/10 rounded-lg py-2 pl-9 pr-4 text-sm text-white"/></div><div className="flex-1 overflow-y-auto molecule-scroll pr-2 space-y-2 mb-6">{moleculeList.map(name => (<button key={name} onClick={() => setSelectedMoleculeName(name)} className={`w-full text-left px-4 py-3 rounded-lg text-sm transition-all flex justify-between ${selectedMoleculeName === name ? 'bg-primary/20 text-primary border border-primary/50' : 'text-slate-400 hover:bg-white/5'}`}>{name}</button>))}</div></div><div className="flex-1 relative bg-gradient-to-br from-gray-900 to-black"><div ref={mountRef} className="w-full h-full cursor-move" /></div>
            </div>
        );
      };

      // --- Eclipse & Solar System Simulation ---
      const EclipseSimulation = ({ onClose }) => {
        const mountRef = useRef(null);
        
        // Simulation State
        const [isPlaying, setIsPlaying] = useState(true);
        const [viewMode, setViewMode] = useState('earth'); // 'space' or 'earth'
        const [sunTemp, setSunTemp] = useState(5800); // Kelvin
        const [moonDist, setMoonDist] = useState(384400); // km
        const [timeline, setTimeline] = useState(0); // 0 to 100
        const [isMinimized, setIsMinimized] = useState(false);
        const [status, setStatus] = useState("NOT ECLIPSED");
        const [isEclipsed, setIsEclipsed] = useState(false);

        // Constants
        const PLANETS = useMemo(() => [
            { name: "Mercury", dist: 20, r: 0.8, color: 0xA5A5A5, speed: 4.1 },
            { name: "Venus", dist: 35, r: 1.2, color: 0xE3BB76, speed: 1.6 },
            { name: "Earth", dist: 50, r: 1.3, color: 0x2233FF, speed: 1.0 }, // Earth ref
            { name: "Mars", dist: 70, r: 0.9, color: 0xDD4422, speed: 0.5 },
            { name: "Jupiter", dist: 100, r: 3.5, color: 0xD9A07E, speed: 0.08 },
            { name: "Saturn", dist: 140, r: 3.0, color: 0xF4D03F, speed: 0.03, ring: true },
            { name: "Uranus", dist: 180, r: 2.0, color: 0x4FD0E7, speed: 0.01 },
            { name: "Neptune", dist: 210, r: 1.9, color: 0x3366FF, speed: 0.006 }
        ], []);

        // Helper: Temp to Color
        const getStarColor = (temp) => {
            const t = Math.max(2000, Math.min(12000, temp));
            const color = new THREE.Color();
            if (t < 6000) {
                const p = (t - 2000) / 4000;
                color.setRGB(1, 0.2 + 0.8 * p, 0.8 * p);
            } else {
                const p = (t - 6000) / 6000;
                color.setRGB(1 - 0.4 * p, 1 - 0.2 * p, 1);
            }
            return color;
        };

        const simRef = useRef({
            scene: null, camera: null, renderer: null, controls: null,
            objects: {}, animId: null, time: 0
        });

        // Initialize Three.js
        useEffect(() => {
            if (!mountRef.current) return;
            
            const w = mountRef.current.clientWidth;
            const h = mountRef.current.clientHeight;
            const scene = new THREE.Scene();
            scene.background = new THREE.Color(0x000000); // Space Black

            // Camera
            const camera = new THREE.PerspectiveCamera(60, w / h, 0.1, 2000);
            const renderer = new THREE.WebGLRenderer({ antialias: true, logarithmicDepthBuffer: true });
            renderer.setSize(w, h);
            renderer.shadowMap.enabled = true;
            mountRef.current.appendChild(renderer.domElement);

            const controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;

            // --- Solar System Objects ---
            const objects = {};

            // 1. Sun
            const sunGeo = new THREE.SphereGeometry(8, 64, 64);
            const sunMat = new THREE.MeshBasicMaterial({ color: 0xffffff });
            const sun = new THREE.Mesh(sunGeo, sunMat);
            scene.add(sun);
            objects.sun = sun;

            // Sun Light
            const sunLight = new THREE.PointLight(0xffffff, 2, 800);
            scene.add(sunLight);
            objects.sunLight = sunLight;

            // Sun Glow (Corona) - visible always but highlighted during eclipse
            const coronaGeo = new THREE.PlaneGeometry(30, 30);
            const coronaMat = new THREE.MeshBasicMaterial({ 
                color: 0xffaa00, transparent: true, opacity: 0, 
                side: THREE.DoubleSide, blending: THREE.AdditiveBlending, depthWrite: false 
            });
            const corona = new THREE.Mesh(coronaGeo, coronaMat);
            scene.add(corona); // Billboard behavior added in loop
            objects.corona = corona;

            // 2. Planets
            objects.planets = [];
            PLANETS.forEach(p => {
                const grp = new THREE.Group();
                scene.add(grp);
                
                // Planet Mesh
                const mesh = new THREE.Mesh(
                    new THREE.SphereGeometry(p.r, 32, 32),
                    new THREE.MeshStandardMaterial({ color: p.color, roughness: 0.7 })
                );
                grp.add(mesh);

                // Ring for Saturn
                if (p.ring) {
                    const ringGeo = new THREE.RingGeometry(p.r * 1.4, p.r * 2.2, 64);
                    const ringMat = new THREE.MeshBasicMaterial({ color: 0xffffff, side: THREE.DoubleSide, transparent: true, opacity: 0.4 });
                    const ring = new THREE.Mesh(ringGeo, ringMat);
                    ring.rotation.x = Math.PI / 2;
                    grp.add(ring);
                }

                // Orbit Ring (White Line)
                const orbitCurve = new THREE.EllipseCurve(0, 0, p.dist, p.dist, 0, 2 * Math.PI, false, 0);
                const points = orbitCurve.getPoints(128);
                const orbitGeo = new THREE.BufferGeometry().setFromPoints(points);
                const orbitMat = new THREE.LineBasicMaterial({ color: 0xffffff, transparent: true, opacity: 0.15 });
                const orbitLine = new THREE.Line(orbitGeo, orbitMat);
                orbitLine.rotation.x = Math.PI / 2;
                scene.add(orbitLine);

                objects.planets.push({ 
                    data: p, grp, mesh
                });
            });

            // 3. Earth System specific
            const earthObj = objects.planets.find(p => p.data.name === "Earth");
            const moonPivot = new THREE.Group();
            earthObj.mesh.add(moonPivot);
            const moon = new THREE.Mesh(
                new THREE.SphereGeometry(0.4, 32, 32),
                new THREE.MeshStandardMaterial({ color: 0x888888, roughness: 0.9 })
            );
            moonPivot.add(moon);
            objects.moonPivot = moonPivot;
            objects.moon = moon;
            objects.earth = earthObj.mesh; // shortcut

            // 4. Atmosphere (Sky Dome for Earth View)
            const skyGeo = new THREE.SphereGeometry(500, 32, 32);
            const skyMat = new THREE.MeshBasicMaterial({ color: 0x87CEEB, side: THREE.BackSide, transparent: true, opacity: 0 });
            const sky = new THREE.Mesh(skyGeo, skyMat);
            scene.add(sky);
            objects.sky = sky;

            // 5. Starfield
            const starGeo = new THREE.BufferGeometry();
            const starPos = [];
            for(let i=0; i<5000; i++) {
                const r = 800 + Math.random() * 800;
                const theta = Math.random() * Math.PI * 2;
                const phi = Math.acos(2 * Math.random() - 1);
                starPos.push(r * Math.sin(phi) * Math.cos(theta));
                starPos.push(r * Math.sin(phi) * Math.sin(theta));
                starPos.push(r * Math.cos(phi));
            }
            starGeo.setAttribute('position', new THREE.Float32BufferAttribute(starPos, 3));
            const stars = new THREE.Points(starGeo, new THREE.PointsMaterial({ color: 0xffffff, size: 1.5 }));
            scene.add(stars);

            simRef.current = { scene, camera, renderer, controls, objects, animId: null, time: 0 };

            const handleResize = () => {
                if(!mountRef.current) return;
                const w = mountRef.current.clientWidth;
                const h = mountRef.current.clientHeight;
                camera.aspect = w/h;
                camera.updateProjectionMatrix();
                renderer.setSize(w, h);
            };
            window.addEventListener('resize', handleResize);

            return () => {
                window.removeEventListener('resize', handleResize);
                cancelAnimationFrame(simRef.current.animId);
                if (mountRef.current && renderer.domElement) {
                    mountRef.current.removeChild(renderer.domElement);
                }
                renderer.dispose();
            };
        }, []);

        // Simulation Loop
        useEffect(() => {
            const loop = () => {
                const state = simRef.current;
                if (!state.scene) return;

                state.animId = requestAnimationFrame(loop);

                // Time management
                if (isPlaying) {
                    // Update Timeline state to reflect progression
                    setTimeline(t => {
                        const next = t + 0.05;
                        return next > 100 ? 0 : next;
                    });
                }
                
                // Calculate master time from timeline state (0-100 -> 0-2PI)
                const masterTime = (timeline / 100) * (Math.PI * 2); 

                // FIX: Destructure directly from state, not state.objects
                const { camera, controls, objects } = state; 
                const { sun, sunLight, planets, moonPivot, moon, sky, earth, corona } = objects;

                // Update Sun Appearance
                const sColor = getStarColor(sunTemp);
                sun.material.color.copy(sColor);
                sunLight.color.copy(sColor);
                corona.material.color.copy(sColor);

                // Update Planets
                planets.forEach(p => {
                    const angle = masterTime * (1.0 / p.data.speed) * 5; // Scaling for visual speed
                    const x = Math.cos(angle) * p.data.dist;
                    const z = Math.sin(angle) * p.data.dist;
                    
                    p.grp.position.set(x, 0, z);
                    p.mesh.rotation.y += 0.01;
                });

                // Update Moon
                // Slider range 350k - 410k maps to sim units approx 4 - 6
                const visualMoonDist = 4 + (moonDist - 350000) / 60000 * 2; 
                moon.position.set(visualMoonDist, 0, 0);
                
                // Moon orbit speed relative to Earth (fast)
                moonPivot.rotation.y = masterTime * 12;

                // --- View & Eclipse Logic ---
                if (viewMode === 'earth') {
                    // Position camera on Earth surface facing Sun
                    const earthPos = new THREE.Vector3();
                    earth.getWorldPosition(earthPos);
                    const sunPos = new THREE.Vector3(0,0,0);
                    
                    const toSun = new THREE.Vector3().subVectors(sunPos, earthPos).normalize();
                    const surfaceOffset = toSun.clone().multiplyScalar(2.0); // Offset slightly above surface
                    const camPos = earthPos.clone().add(surfaceOffset);
                    
                    camera.position.copy(camPos);
                    camera.lookAt(sunPos);
                    
                    // Eclipse Calc
                    const moonPos = new THREE.Vector3();
                    moon.getWorldPosition(moonPos);
                    
                    const toMoon = new THREE.Vector3().subVectors(moonPos, camPos).normalize();
                    const angle = toSun.angleTo(toMoon); // Angular separation in radians
                    
                    // Apparent Radii
                    // tan(theta) = radius / distance. For small angles tan(theta) ~= theta
                    const distToSun = camPos.distanceTo(sunPos);
                    const distToMoon = camPos.distanceTo(moonPos);
                    
                    const sunApparentR = Math.atan(8 / distToSun); // Sun R=8
                    const moonApparentR = Math.atan(0.4 / distToMoon); // Moon R=0.4
                    
                    // Basic overlap check
                    const separation = angle;
                    const combinedR = sunApparentR + moonApparentR;
                    
                    let coverage = 0;
                    if (separation < combinedR) {
                         // Simple linear approx for coverage
                         coverage = 1.0 - (separation / combinedR);
                         coverage = Math.max(0, Math.min(1, coverage));
                         // Make it steeper for full eclipse feel
                         if (separation < (sunApparentR - moonApparentR) + 0.02) coverage = 1.0; 
                    }
                    
                    // Determine Status text
                    let st = "NOT ECLIPSED";
                    if (coverage > 0.05) st = "PARTIAL ECLIPSE";
                    if (coverage > 0.95) st = "TOTAL ECLIPSE";
                    else if (coverage > 0.8) st = "DEPARTING"; // Simplification for demo
                    
                    // Sky Color Logic
                    // Base sky depends on Sun Temp (Hotter = Bluer, Cooler = Redder)
                    // Darkness depends on Coverage
                    const baseSkyColor = sColor.clone().lerp(new THREE.Color(0x87CEEB), 0.5); // Mix sun color with sky blue
                    const darkSpaceColor = new THREE.Color(0x050505);
                    
                    // If eclipsed, lerp to dark
                    const eclipseDarkness = coverage > 0.9 ? 0.95 : coverage * 0.7;
                    const finalSky = baseSkyColor.clone().lerp(darkSpaceColor, eclipseDarkness);
                    
                    // If sun is very cool (Red Dwarf), sky is darker/redder naturally
                    if (sunTemp < 3500) finalSky.multiplyScalar(0.6);

                    sky.material.color.copy(finalSky);
                    sky.material.opacity = 1;
                    sky.position.copy(earthPos);
                    
                    // Ring of Fire / Corona
                    // Billboard corona to camera
                    corona.position.copy(sunPos);
                    corona.lookAt(camera.position);
                    
                    if (coverage > 0.92) {
                        corona.material.opacity = (coverage - 0.92) * 12; // Fade in rapidly
                        corona.scale.setScalar(1 + Math.sin(Date.now()/100)*0.05); // Flicker
                    } else {
                        corona.material.opacity = 0;
                    }
                    
                    // Update React State occasionally to avoid thrashing
                    // (In a real app, use ref for status or throttle)
                    if (Math.random() < 0.1) {
                         setStatus(st);
                         setIsEclipsed(coverage > 0.95);
                    }

                } else {
                    // Space View
                    controls.update();
                    sky.material.opacity = 0;
                    corona.material.opacity = 0.2; // Faint glow in space
                    corona.lookAt(camera.position);
                }

                state.renderer.render(scene, camera);
            };
            loop();
        }, [sunTemp, moonDist, viewMode, isPlaying, timeline]); // Dependencies update refs inside loop

        // Sync timeline dragging
        const onTimelineChange = (e) => {
            const val = parseFloat(e.target.value);
            setTimeline(val);
            setIsPlaying(false);
        };

        return (
            <div className="fixed inset-0 z-[100] bg-black/95 animate-in fade-in duration-300 font-display">
                <div ref={mountRef} className="absolute inset-0 z-0 block w-full h-full" />
                
                {/* Back Button */}
                <button onClick={onClose} className="absolute top-6 left-6 z-50 flex items-center gap-2 bg-surface-dark/80 backdrop-blur-md px-4 py-3 rounded-full text-white font-medium hover:bg-surface-dark transition-colors border border-white/10 shadow-lg group">
                    <span className="material-symbols-outlined text-lg group-hover:-translate-x-1 transition-transform">arrow_back</span>
                    Back to Portfolio
                </button>

                {/* Surface Telemetry (Bottom Left) */}
                <div className="absolute bottom-6 left-6 z-40 max-w-xs pointer-events-none">
                    <div className="text-[10px] font-bold text-slate-500 mb-2 uppercase tracking-widest pl-1">Current Mode</div>
                    <h2 className="text-4xl font-black text-white mb-4 tracking-tighter drop-shadow-md">SURFACE TELEMETRY</h2>
                    <div className="bg-surface-dark/90 backdrop-blur-md p-5 rounded-xl border border-white/10 shadow-2xl">
                        <div className="flex items-center gap-3 mb-2">
                            <span className={`material-symbols-outlined text-2xl ${isEclipsed ? 'text-secondary animate-pulse' : 'text-yellow-500'}`}>
                                {isEclipsed ? 'dark_mode' : 'light_mode'}
                            </span>
                            <span className={`font-bold text-lg uppercase ${isEclipsed ? 'text-secondary' : 'text-white'}`}>{status}</span>
                        </div>
                        <p className="text-xs text-slate-400 leading-relaxed font-mono">
                            {isEclipsed 
                                ? "Total obstruction detected. Solar corona visible. Surface temperature dropping." 
                                : status === "PARTIAL ECLIPSE" ? "Satellite obstructing solar vector. Ambient light diminishing."
                                : "Clear sky. Moon is not currently obstructing solar rays."}
                        </p>
                    </div>
                </div>

                {/* Minimized Toggle */}
                <button 
                    onClick={() => setIsMinimized(!isMinimized)}
                    className="absolute bottom-6 right-6 z-[60] bg-surface-dark/90 backdrop-blur border border-white/10 p-3 rounded-full text-white hover:text-primary hover:border-primary transition-all shadow-lg"
                >
                    <span className="material-symbols-outlined">{isMinimized ? 'tune' : 'expand_more'}</span>
                </button>

                {/* System Controls (Bottom Right) */}
                <div className={`absolute bottom-6 left-1/2 -translate-x-1/2 md:translate-x-0 md:left-auto md:right-6 md:bottom-20 w-full max-w-sm bg-[#111820]/95 backdrop-blur-xl rounded-xl border border-white/10 p-6 shadow-2xl z-50 transition-all duration-300 origin-bottom-right ${isMinimized ? 'scale-0 opacity-0' : 'scale-100 opacity-100'}`}>
                    {/* Header */}
                    <div className="flex items-center gap-2 mb-6 text-white border-b border-white/10 pb-4">
                        <span className="material-symbols-outlined text-secondary">solar_power</span>
                        <h3 className="font-bold text-lg">System Controls</h3>
                    </div>

                    {/* View Toggles */}
                    <div className="grid grid-cols-2 gap-1 p-1 bg-black/40 rounded-lg mb-6 border border-white/5">
                        <button onClick={() => setViewMode('space')} className={`py-2 rounded-md text-xs font-bold uppercase tracking-wider transition-all ${viewMode === 'space' ? 'bg-surface-dark text-white shadow-lg' : 'text-slate-500 hover:text-slate-300'}`}>Space View</button>
                        <button onClick={() => setViewMode('earth')} className={`py-2 rounded-md text-xs font-bold uppercase tracking-wider transition-all ${viewMode === 'earth' ? 'bg-secondary text-white shadow-neon-purple' : 'text-slate-500 hover:text-slate-300'}`}>Earth View</button>
                    </div>

                    {/* Slider 1: Temp */}
                    <div className="mb-4 space-y-2">
                        <div className="flex justify-between text-xs font-medium">
                            <span className="text-slate-400">Stellar Surface Temp</span>
                            <span className="text-yellow-400 font-mono">{Math.round(sunTemp)} K</span>
                        </div>
                        <input type="range" min="2000" max="12000" step="100" value={sunTemp} onChange={(e) => setSunTemp(parseFloat(e.target.value))} className="w-full h-1 bg-slate-700 rounded-lg appearance-none cursor-pointer temp-slider"/>
                        <div className="flex justify-between text-[8px] text-slate-600 font-mono uppercase"><span>Red Dwarf</span><span>Sun</span><span>Blue Giant</span></div>
                    </div>

                    {/* Slider 2: Moon Dist */}
                    <div className="mb-6 space-y-2">
                        <div className="flex justify-between text-xs font-medium">
                            <span className="text-slate-400">Lunar Distance</span>
                            <span className="text-secondary font-mono">{moonDist.toLocaleString()} km</span>
                        </div>
                        <input type="range" min="350000" max="410000" step="100" value={moonDist} onChange={(e) => setMoonDist(parseFloat(e.target.value))} className="range-slider"/>
                    </div>

                    {/* Scrubber */}
                    <div className="pt-4 border-t border-white/10">
                        <div className="flex items-center gap-4">
                            <button onClick={() => setIsPlaying(!isPlaying)} className={`w-10 h-10 rounded-full border border-white/20 flex items-center justify-center transition-all ${isPlaying ? 'text-secondary bg-secondary/10 border-secondary' : 'text-slate-400 hover:text-white hover:bg-white/10'}`}>
                                <span className="material-symbols-outlined">{isPlaying ? 'pause' : 'play_arrow'}</span>
                            </button>
                            <div className="flex-1">
                                <div className="text-[10px] uppercase tracking-wider text-slate-500 mb-1 font-mono">Timeline Scrubber</div>
                                <input type="range" min="0" max="100" step="0.1" value={timeline} onChange={onTimelineChange} className="range-slider"/>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        );
      };

      // --- Contact Component ---
      const Contact = () => {
        return (
           <section id="contact" className="py-32 px-4 sm:px-6 relative overflow-hidden bg-void">
            <ShootingStars />
            <div className="absolute top-0 w-full h-px bg-gradient-to-r from-transparent via-secondary/50 to-transparent"></div>
            <div className="mx-auto max-w-2xl text-center relative z-10">
              <h2 className="text-4xl font-black text-white mb-6 sm:text-6xl tracking-tighter">Signal Received?</h2>
              <p className="text-lg text-slate-400 mb-12 font-light">Ready to collaborate on the next frontier of web design? <br className="hidden sm:block"/> My frequency is open for new opportunities.</p>
              <div className="flex flex-col sm:flex-row gap-6 justify-center">
                <a href="mailto:nguyennhathanhhuy@gmail.com" className="flex items-center justify-center gap-3 bg-[#0a0f14]/80 backdrop-blur border border-slate-800 hover:border-secondary text-white px-8 py-4 rounded-lg transition-all group shadow-lg hover:shadow-neon-purple"><span className="material-symbols-outlined text-secondary group-hover:animate-pulse">mail</span><span className="font-medium tracking-wide">nguyennhathanhhuy@gmail.com</span></a>
                <div className="flex gap-4 justify-center items-center">{['GitHub', 'LinkedIn'].map((platform) => (<a key={platform} href="#" className={`h-14 w-14 flex items-center justify-center rounded-lg bg-[#0a0f14]/80 backdrop-blur border border-slate-800 text-slate-400 hover:text-white hover:border-${platform === 'GitHub' ? 'primary' : 'secondary'} hover:shadow-${platform === 'GitHub' ? 'neon' : 'neon-purple'} transition-all`} aria-label={platform}><span className="material-symbols-outlined">{platform === 'GitHub' ? 'code_blocks' : 'person_search'}</span></a>))}</div>
              </div>
            </div>
          </section>
        );
      };

      // --- Black Hole Background ---
      const BlackHoleBackground = ({ progress }) => {
        const canvasRef = useRef(null); const angleRef = useRef(0);
        useEffect(() => {
          const canvas = canvasRef.current; const ctx = canvas.getContext('2d');
          const render = () => {
            canvas.width = window.innerWidth; canvas.height = window.innerHeight;
            const w = canvas.width; const h = canvas.height; const cx = w / 2; const cy = h / 2;
            ctx.fillStyle = '#020204'; ctx.fillRect(0, 0, w, h);
            for(let i=0; i<150; i++) {
                const x = (Math.sin(i * 123.456) * 9999) % w; const y = (Math.cos(i * 654.321) * 9999) % h;
                const size = (Math.sin(i) + 1.5) * 0.8; const opacity = (Math.cos(i) + 1) * 0.3 + 0.1;
                ctx.fillStyle = `rgba(255,255,255,${Math.abs(opacity)})`; ctx.beginPath(); ctx.arc(Math.abs(x), Math.abs(y), size, 0, Math.PI * 2); ctx.fill();
            }
            const p = progress; const merged = p > 0.98; const maxSep = Math.min(w, h) * 0.25;
            const currentOrbitRadius = merged ? 0 : (maxSep/2) * (1 - p);
            angleRef.current += 0.02 + (Math.pow(p, 3) * 0.15); const angle = angleRef.current;
            ctx.save(); ctx.translate(cx, cy);
            if (!merged) {
                ctx.save(); ctx.rotate(angle * 0.2); 
                for(let i=0; i<8; i++) {
                    const waveR = ((i/8 + Date.now()/10000 * (0.1+p*0.4)) % 1) * Math.max(w,h)*0.6;
                    ctx.strokeStyle = `rgba(100, 100, 255, ${(p * 0.6 + 0.1) * (1 - waveR/Math.max(w,h))})`;
                    ctx.lineWidth = 1 + p * 5; ctx.beginPath(); ctx.ellipse(0, 0, waveR, waveR * (1 - p * 0.1), -angle, 0, Math.PI * 2); ctx.stroke();
                }
                ctx.restore();
            }
            const drawBH = (x, y, r, c) => {
                const grad = ctx.createRadialGradient(x, y, r * 0.8, x, y, r * 3); grad.addColorStop(0, '#000'); grad.addColorStop(0.2, c); grad.addColorStop(1, 'transparent');
                ctx.fillStyle = grad; ctx.beginPath(); ctx.arc(x, y, r * 3, 0, Math.PI * 2); ctx.fill();
                ctx.fillStyle = '#000'; ctx.beginPath(); ctx.arc(x, y, r * 0.95, 0, Math.PI * 2); ctx.fill();
                ctx.strokeStyle = '#fff'; ctx.lineWidth = 2; ctx.shadowColor = c; ctx.shadowBlur = 15; ctx.beginPath(); ctx.arc(x, y, r, 0, Math.PI * 2); ctx.stroke(); ctx.shadowBlur = 0;
            };
            if(merged) drawBH(0,0,32,'rgba(150, 200, 255, 0.9)');
            else {
                drawBH(Math.cos(angle)*currentOrbitRadius, Math.sin(angle)*currentOrbitRadius, 20, 'rgba(6, 188, 249, 0.8)');
                drawBH(Math.cos(angle+Math.PI)*currentOrbitRadius, Math.sin(angle+Math.PI)*currentOrbitRadius, 20, 'rgba(168, 85, 247, 0.8)');
            }
            ctx.restore();
          };
          const animId = requestAnimationFrame(function loop() { render(); requestAnimationFrame(loop); });
          return () => cancelAnimationFrame(animId);
        }, [progress]);
        return <canvas ref={canvasRef} className="absolute inset-0 z-0 h-full w-full object-cover" />;
      };

      const Navbar = () => {
        const [isOpen, setIsOpen] = useState(false);
        const [scrolled, setScrolled] = useState(false);
        useEffect(() => { const h = () => setScrolled(window.scrollY > 20); window.addEventListener('scroll', h); return () => window.removeEventListener('scroll', h); }, []);
        return (
          <nav className={`fixed top-0 z-50 w-full border-b transition-colors duration-300 ${scrolled ? 'border-white/5 bg-background-dark/90 backdrop-blur-md' : 'border-transparent bg-transparent'}`}>
            <div className="mx-auto flex h-16 max-w-7xl items-center justify-between px-6 lg:px-8">
              <div className="flex items-center gap-4"><div className="h-10 w-10 rounded-full bg-cover bg-center ring-2 ring-primary/50 shadow-neon" style={{ backgroundImage: `url('${PROFILE_AVATAR}')` }}/><span className="text-lg font-bold tracking-tight text-white hidden sm:block">Thanh Huy</span></div>
              <div className="hidden md:flex items-center gap-8">{NAV_ITEMS.map((item) => (<a key={item.label} href={item.href} className="text-sm font-medium text-slate-300 hover:text-primary transition-colors">{item.label}</a>))}</div>
              <button onClick={() => setIsOpen(!isOpen)} className="md:hidden p-2 text-slate-300 hover:text-white"><span className="material-symbols-outlined">{isOpen ? 'close' : 'menu'}</span></button>
            </div>
            {isOpen && (<div className="md:hidden absolute top-16 left-0 w-full bg-background-dark/95 border-b border-white/5 backdrop-blur-md py-4"><div className="flex flex-col items-center gap-4">{NAV_ITEMS.map((item) => (<a key={item.label} href={item.href} onClick={() => setIsOpen(false)} className="text-base font-medium text-slate-300 hover:text-primary transition-colors">{item.label}</a>))}</div></div>)}
          </nav>
        );
      };

      const Hero = () => {
        const [timeData, setTimeData] = useState(100); const [isControlOpen, setIsControlOpen] = useState(true);
        return (
          <section id="home" className="relative flex min-h-[90vh] flex-col items-center justify-center overflow-hidden px-4 sm:px-6 bg-[#020204]">
            <BlackHoleBackground progress={timeData / 100} />
            <div className="absolute inset-0 z-0 bg-gradient-to-t from-background-dark via-transparent to-background-dark/50 pointer-events-none"></div>
            <div className="relative z-10 mx-auto max-w-5xl text-center mt-10 pointer-events-none">
              <p className="mb-4 text-xs font-bold uppercase tracking-[0.2em] text-primary/80">2026 Portfolio</p>
              <h1 className="mb-6 text-5xl font-black leading-tight tracking-tight text-white sm:text-7xl lg:text-8xl drop-shadow-2xl">Atomizing the <span className="text-transparent bg-clip-text bg-gradient-to-r from-primary via-cyan-300 to-white">Celestial</span> <br/><span className="text-transparent bg-clip-text bg-gradient-to-r from-secondary via-purple-400 to-white">Bodies</span></h1>
              <p className="mx-auto mb-10 max-w-2xl text-lg font-light leading-relaxed text-slate-300 sm:text-xl drop-shadow-md">I'm <span className="text-white font-medium">Thanh Huy</span>. I am a student who is dedicated to <GradientText>chemistry and astronomy</GradientText>. I use my coding skills to create digital experiences.</p>
            </div>
            <div className="relative z-20 flex flex-col sm:flex-row gap-4 justify-center items-center">
              <a href="#projects" className="group relative flex h-12 items-center justify-center overflow-hidden rounded-full bg-primary px-8 text-sm font-bold text-[#020204] transition-all hover:bg-cyan-300 hover:shadow-neon"><span className="relative z-10 mr-2">Explore Universe</span><span className="material-symbols-outlined relative z-10 text-[20px] transition-transform group-hover:translate-x-1">rocket_launch</span></a>
              <a href="#contact" className="flex h-12 items-center justify-center rounded-full border border-slate-700 px-8 text-sm font-bold text-white transition-colors hover:border-secondary hover:text-secondary hover:shadow-neon-purple bg-surface-dark/50 backdrop-blur-sm">Contact Me</a>
            </div>
            <div className="absolute bottom-10 left-0 right-0 mx-auto w-full max-w-md z-30 px-6 flex justify-center">
                {isControlOpen ? (<div className="w-full bg-surface-dark/60 backdrop-blur-md p-4 rounded-xl border border-white/10 shadow-2xl animate-in fade-in slide-in-from-bottom-4 duration-500"><div className="flex justify-between items-center mb-3"><div className="flex justify-between text-[10px] text-primary uppercase font-mono tracking-widest gap-4"><span>Binary System</span><span>Singularity</span></div><button onClick={() => setIsControlOpen(false)} className="text-slate-400 hover:text-white transition-colors"><span className="material-symbols-outlined text-sm">remove</span></button></div><input type="range" min="0" max="100" value={timeData} onChange={(e) => setTimeData(Number(e.target.value))} className="range-slider"/><div className="flex justify-between items-center mt-2"><span className="text-[10px] text-slate-400 font-mono">T-Minus: {(100 - timeData).toFixed(0)} units</span><span className={`text-[10px] font-mono transition-colors ${timeData > 95 ? 'text-red-500 animate-pulse font-bold' : 'text-slate-500'}`}>{timeData > 95 ? 'CRITICAL: MERGER IMMINENT' : 'STATUS: STABLE ORBIT'}</span></div></div>) : (<button onClick={() => setIsControlOpen(true)} className="flex items-center gap-2 bg-surface-dark/40 backdrop-blur-sm border border-white/10 hover:border-primary/50 text-slate-300 hover:text-white px-4 py-2 rounded-full transition-all shadow-lg hover:shadow-neon"><span className="material-symbols-outlined text-sm">tune</span><span className="text-xs font-bold uppercase tracking-wider">Initialize Controls</span></button>)}
            </div>
          </section>
        );
      };

      const Projects = ({ onOpenProject }) => {
        return (
          <section id="projects" className="py-24 px-4 sm:px-6 lg:px-8 relative bg-void overflow-hidden">
            <div className="absolute inset-0 z-0 bg-stars opacity-40"></div>
            <div className="absolute top-0 right-0 w-[600px] h-[600px] bg-secondary/20 blur-[130px] rounded-full pointer-events-none"></div>
            <div className="absolute bottom-0 left-0 w-[700px] h-[700px] bg-primary/10 blur-[130px] rounded-full pointer-events-none"></div>
            <div className="relative z-10 mx-auto max-w-6xl">
              <div className="flex items-end justify-between mb-16 border-b border-white/10 pb-6"><div><span className="text-secondary font-mono text-sm tracking-widest mb-2 block">SELECTED WORKS</span><h2 className="text-3xl font-bold text-white sm:text-4xl">Exploration Log</h2></div><a href="#" className="hidden sm:flex items-center gap-2 text-sm font-medium text-slate-400 hover:text-secondary transition-colors">Full Archive <span className="material-symbols-outlined text-[16px]">arrow_forward</span></a></div>
              <div className="grid grid-cols-1 gap-10 md:grid-cols-2 lg:grid-cols-3">
                {PROJECTS.map((project, idx) => (
                  <div key={idx} onClick={() => onOpenProject(project.id)} className={`group relative cursor-pointer overflow-hidden rounded-xl bg-[#0a0f14] border border-white/5 transition-all duration-300 hover:-translate-y-2 hover:border-${project.color === 'primary' ? 'primary' : 'secondary'}/50 hover:shadow-neon${project.color !== 'primary' ? '-purple' : ''}`}>
                    <div className="aspect-[4/3] w-full overflow-hidden relative"><div className="h-full w-full bg-cover bg-center transition-transform duration-700 group-hover:scale-110" style={{ backgroundImage: `url('${project.image}')`, filter: 'brightness(0.8) contrast(1.2)' }}><div className="absolute inset-0 bg-gradient-to-t from-[#0a0f14] via-transparent to-transparent opacity-90"></div></div><div className={`absolute top-4 right-4 bg-${project.color === 'primary' ? 'primary' : 'purple-500'}/20 backdrop-blur-md border border-${project.color === 'primary' ? 'primary' : 'purple-500'}/30 text-${project.color === 'primary' ? 'primary' : 'purple-300'} text-xs font-bold px-3 py-1 rounded-full`}>{project.category}</div></div>
                    <div className="absolute bottom-0 left-0 w-full p-6"><h3 className={`text-xl font-bold text-white group-hover:text-${project.color} transition-colors`}>{project.title}</h3><p className="mt-2 text-sm text-slate-400 line-clamp-2">{project.description}</p><div className="mt-4 flex gap-2">{project.tags.map(tag => (<span key={tag} className="text-[10px] uppercase tracking-wider text-slate-500 font-mono">{tag}</span>))}</div></div>
                  </div>
                ))}
              </div>
            </div>
          </section>
        );
      };

      const About = () => {
        return (
          <section id="about" className="py-24 px-4 sm:px-6 lg:px-8 bg-[#050505] relative overflow-hidden">
            <div className="absolute top-0 right-0 w-[400px] h-[400px] bg-primary/10 blur-[100px] rounded-full pointer-events-none"></div>
            <div className="absolute bottom-0 left-0 w-[400px] h-[400px] bg-secondary/10 blur-[100px] rounded-full pointer-events-none"></div>
            <div className="mx-auto max-w-4xl relative z-10">
              <div className="mb-16 text-center"><h2 className="text-3xl font-bold text-white sm:text-4xl"><span className="text-primary">Tech</span> & <span className="text-secondary">Science</span> Stack</h2></div>
              <div className="grid grid-cols-1 md:grid-cols-2 gap-16 items-center">
                <div className="space-y-6 order-2 md:order-1"><h3 className="text-xl font-bold text-white flex items-center gap-2"><span className="material-symbols-outlined text-secondary">science</span> Scientific Methodology</h3><p className="text-slate-400 leading-relaxed">I am driven by an unyielding curiosity to understand the mechanisms of our universe. I treat every project with extreme patience and carefulness, ensuring that every detail is accounted for.</p><div className="pt-4"><a href="#" className="inline-flex items-center text-white border-b border-primary pb-1 hover:text-primary transition-colors font-medium">Analyze Resume <span className="material-symbols-outlined ml-2 text-lg">download</span></a></div></div>
                <div className="grid grid-cols-2 gap-4 order-1 md:order-2">{TECH_STACK.map((tech) => (<div key={tech.title} className={`bg-surface-dark/50 backdrop-blur-sm p-5 rounded-lg border border-slate-800 hover:border-${tech.color.includes('primary') ? 'primary' : 'secondary'} transition-all group`}><span className={`material-symbols-outlined ${tech.color} mb-3 text-3xl group-hover:scale-110 transition-transform`}>{tech.icon}</span><h4 className="text-white font-bold text-sm uppercase tracking-wider">{tech.title}</h4><p className="text-xs text-slate-500 mt-1 font-mono">{tech.desc}</p></div>))}</div>
              </div>
            </div>
          </section>
        );
      };

      const Footer = () => {
        return (
          <footer className="border-t border-white/5 bg-void py-10 px-6 text-center">
            <p className="text-slate-600 text-sm font-mono">&copy; 2024 Thanh Huy. <span className="text-slate-700 mx-2">|</span> Built in the void with <span className="text-secondary">♥</span> and Tailwind CSS.</p>
          </footer>
        );
      };

      const App = () => {
        const [activeProject, setActiveProject] = useState(null);

        return (
          <main className="relative flex min-h-screen w-full flex-col">
            <Navbar />
            <Hero />
            <Projects onOpenProject={setActiveProject} />
            <About />
            <Contact />
            <Footer />

            {/* Overlays */}
            {activeProject === 'decay' && (
                <DecayChallenge onClose={() => setActiveProject(null)} />
            )}

            {activeProject === 'molecular' && (
                <MolecularViewer onClose={() => setActiveProject(null)} />
            )}
            
            {activeProject === 'eclipse' && (
                <EclipseSimulation onClose={() => setActiveProject(null)} />
            )}
          </main>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
  </body>
</html>