<!DOCTYPE html>
<html lang="en" class="dark scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Thanh Huy - Portfolio</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet" />

    <!-- React Dependencies (UMD) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Three.js Dependencies (Using consistent unpkg versioning) -->
    <script crossorigin src="https://unpkg.com/three@0.128.0/build/three.min.js"></script>
    <script crossorigin src="https://unpkg.com/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#06bcf9", // Neon Blue
                        "secondary": "#a855f7", // Neon Purple
                        "background-light": "#f5f8f8",
                        "background-dark": "#0a1116", // Deep navy/midnight start
                        "void": "#020204", // Deep space black
                        "surface-dark": "#111820",
                    },
                    fontFamily: {
                        "display": ["Space Grotesk", "sans-serif"],
                        "sans": ["Space Grotesk", "sans-serif"],
                    },
                    backgroundImage: {
                        'gradient-radial': 'radial-gradient(var(--tw-gradient-stops))',
                    },
                    boxShadow: {
                        "neon": "0 0 15px rgba(6, 188, 249, 0.3)",
                        "neon-hover": "0 0 25px rgba(6, 188, 249, 0.5)",
                        "neon-purple": "0 0 15px rgba(168, 85, 247, 0.3)",
                        "neon-purple-hover": "0 0 25px rgba(168, 85, 247, 0.6)",
                    }
                },
            },
        }
    </script>
    <style>
        .range-slider {
            -webkit-appearance: none;
            width: 100%;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            outline: none;
        }
        .range-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #06bcf9;
            cursor: pointer;
            box-shadow: 0 0 10px #06bcf9;
            transition: all 0.2s;
        }
        .range-slider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            background: #fff;
            box-shadow: 0 0 15px #fff, 0 0 30px #06bcf9;
        }
        /* Custom scrollbar for molecule list */
        .molecule-scroll::-webkit-scrollbar {
            width: 6px;
        }
        .molecule-scroll::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }
        .molecule-scroll::-webkit-scrollbar-thumb {
            background: #06bcf9;
            border-radius: 3px;
        }
    </style>
  </head>
  <body class="bg-background-light dark:bg-background-dark text-[#101e23] dark:text-white antialiased selection:bg-secondary selection:text-white font-display">
    <div id="root"></div>

    <!-- Main Application Logic -->
    <script type="text/babel">
      const { useState, useEffect, useRef, useMemo } = React;

      // --- Constants & Types ---

      const GITHUB_USERNAME = "Zoinkkzs"; 
      const PROFILE_AVATAR = `https://littleastronomy.com/wp-content/uploads/2023/01/what-are-pulsars-and-how-are-they-formed.jpg`;

      const NAV_ITEMS = [
        { label: 'Home', href: '#home' },
        { label: 'Work', href: '#projects' },
        { label: 'About', href: '#about' },
        { label: 'Contact', href: '#contact' },
      ];

      const PROJECTS = [
        {
          id: 'exploring',
          title: 'Exploring with Curiosity',
          category: 'Space Tech',
          description: 'Interactive WebGL rover simulation visualizing surface data from Mars exploration missions.',
          image: 'https://images.unsplash.com/photo-1541873676-a18131494184?q=80&w=1000&auto=format&fit=crop',
          tags: ['Three.js', 'React'],
          color: 'secondary',
          url: '#'
        },
        {
          id: 'molecular',
          title: 'Molecular Bonds',
          category: 'Chemistry',
          description: 'Educational platform featuring minimalist 3D structure and covalent bond visualizations.',
          image: 'https://images.unsplash.com/photo-1532094349884-543bc11b234d?q=80&w=1000&auto=format&fit=crop',
          tags: ['WebGL', 'D3.js'],
          color: 'primary',
          url: '#'
        },
        {
          id: 'nebula',
          title: 'Nebula Cartography',
          category: 'Astrophysics',
          description: 'Mapping star density in local clusters using high-contrast monochromatic UI design.',
          image: 'https://images.unsplash.com/photo-1462331940025-496dfbfc7564?q=80&w=1000&auto=format&fit=crop',
          tags: ['Data Viz', 'UI/UX'],
          color: 'secondary',
          url: '#'
        }
      ];

      const TECH_STACK = [
        { icon: 'terminal', title: 'Coding', desc: 'Lua, C++', color: 'text-primary' },
        { icon: 'hexagon', title: 'Science', desc: 'Chem, Physics, Mathematics', color: 'text-secondary' },
        { icon: 'database', title: 'Data', desc: 'Python, Java', color: 'text-secondary' },
        { icon: 'palette', title: 'Other Skills', desc: 'Chess, Drawing', color: 'text-primary' },
      ];

      // --- MOLECULAR DATA ---
      const MOLECULES = {
        "Benzene": {
          atoms: [
            { id: 0, el: "C", x: 1.4, y: 0, z: 0 }, { id: 1, el: "C", x: 0.7, y: 1.21, z: 0 },
            { id: 2, el: "C", x: -0.7, y: 1.21, z: 0 }, { id: 3, el: "C", x: -1.4, y: 0, z: 0 },
            { id: 4, el: "C", x: -0.7, y: -1.21, z: 0 }, { id: 5, el: "C", x: 0.7, y: -1.21, z: 0 },
            { id: 6, el: "H", x: 2.4, y: 0, z: 0 }, { id: 7, el: "H", x: 1.2, y: 2.1, z: 0 },
            { id: 8, el: "H", x: -1.2, y: 2.1, z: 0 }, { id: 9, el: "H", x: -2.4, y: 0, z: 0 },
            { id: 10, el: "H", x: -1.2, y: -2.1, z: 0 }, { id: 11, el: "H", x: 1.2, y: -2.1, z: 0 }
          ],
          bonds: [
            { source: 0, target: 1, type: "double" }, { source: 1, target: 2, type: "single" },
            { source: 2, target: 3, type: "double" }, { source: 3, target: 4, type: "single" },
            { source: 4, target: 5, type: "double" }, { source: 5, target: 0, type: "single" },
            { source: 0, target: 6, type: "single" }, { source: 1, target: 7, type: "single" },
            { source: 2, target: 8, type: "single" }, { source: 3, target: 9, type: "single" },
            { source: 4, target: 10, type: "single" }, { source: 5, target: 11, type: "single" }
          ]
        },
        "Water": {
          atoms: [
             { id: 0, el: "O", x: 0, y: 0, z: 0.1 },
             { id: 1, el: "H", x: 0.8, y: -0.6, z: 0 },
             { id: 2, el: "H", x: -0.8, y: -0.6, z: 0 }
          ],
          bonds: [
             { source: 0, target: 1, type: "single" },
             { source: 0, target: 2, type: "single" }
          ]
        },
        "Methanol": {
          atoms: [
             { id: 0, el: "C", x: -0.7, y: 0, z: 0 },
             { id: 1, el: "O", x: 0.7, y: 0, z: 0 },
             { id: 2, el: "H", x: -1.0, y: 1.0, z: 0 },
             { id: 3, el: "H", x: -1.0, y: -0.5, z: 0.9 },
             { id: 4, el: "H", x: -1.0, y: -0.5, z: -0.9 },
             { id: 5, el: "H", x: 1.2, y: -0.8, z: 0 }
          ],
          bonds: [
             { source: 0, target: 1, type: "single" },
             { source: 0, target: 2, type: "single" }, { source: 0, target: 3, type: "single" }, { source: 0, target: 4, type: "single" },
             { source: 1, target: 5, type: "single" }
          ]
        },
        "Ethanol": {
            atoms: [
                {id: 0, el: "C", x: -1.2, y: 0, z: 0}, {id: 1, el: "C", x: 0, y: 0.5, z: 0},
                {id: 2, el: "O", x: 1.2, y: -0.2, z: 0}, {id: 3, el: "H", x: 1.8, y: 0.5, z: 0},
                {id: 4, el: "H", x: -1.2, y: -1.1, z: 0}, {id: 5, el: "H", x: -2.1, y: 0.4, z: 0},
                {id: 6, el: "H", x: -1.2, y: 0.4, z: 1.0}, {id: 7, el: "H", x: 0, y: 1.6, z: 0},
                {id: 8, el: "H", x: 0, y: 0.1, z: -1.0}
            ],
            bonds: [
                {source: 0, target: 1, type: "single"}, {source: 1, target: 2, type: "single"},
                {source: 2, target: 3, type: "single"}, {source: 0, target: 4, type: "single"},
                {source: 0, target: 5, type: "single"}, {source: 0, target: 6, type: "single"},
                {source: 1, target: 7, type: "single"}, {source: 1, target: 8, type: "single"}
            ]
        },
        "Acetic Acid": {
            atoms: [
                {id: 0, el: "C", x: -1.0, y: 0, z: 0},
                {id: 1, el: "C", x: 0.5, y: 0, z: 0},
                {id: 2, el: "O", x: 1.2, y: 1.2, z: 0},
                {id: 3, el: "O", x: 1.1, y: -1.2, z: 0},
                {id: 4, el: "H", x: 0.5, y: -1.8, z: 0}, // Acidic H
                {id: 5, el: "H", x: -1.4, y: 1.0, z: 0}, {id: 6, el: "H", x: -1.4, y: -0.5, z: 0.9}, {id: 7, el: "H", x: -1.4, y: -0.5, z: -0.9}
            ],
            bonds: [
                {source: 0, target: 1, type: "single"},
                {source: 1, target: 2, type: "double"},
                {source: 1, target: 3, type: "single"},
                {source: 3, target: 4, type: "single"},
                {source: 0, target: 5, type: "single"}, {source: 0, target: 6, type: "single"}, {source: 0, target: 7, type: "single"}
            ]
        },
        "Butadiene": {
            atoms: [
                {id: 0, el: "C", x: -2, y: -0.5, z: 0}, {id: 1, el: "C", x: -0.7, y: 0.5, z: 0},
                {id: 2, el: "C", x: 0.7, y: -0.5, z: 0}, {id: 3, el: "C", x: 2, y: 0.5, z: 0},
                {id: 4, el: "H", x: -2, y: -1.6, z: 0}, {id: 5, el: "H", x: -2.9, y: 0.05, z: 0},
                {id: 6, el: "H", x: -0.7, y: 1.6, z: 0}, {id: 7, el: "H", x: 0.7, y: -1.6, z: 0},
                {id: 8, el: "H", x: 2, y: 1.6, z: 0}, {id: 9, el: "H", x: 2.9, y: -0.05, z: 0}
            ],
            bonds: [
                {source: 0, target: 1, type: "double"}, {source: 1, target: 2, type: "single"},
                {source: 2, target: 3, type: "double"}, {source: 0, target: 4, type: "single"},
                {source: 0, target: 5, type: "single"}, {source: 1, target: 6, type: "single"},
                {source: 2, target: 7, type: "single"}, {source: 3, target: 8, type: "single"},
                {source: 3, target: 9, type: "single"}
            ]
        },
        "Cyclohexane": {
            atoms: [
                {id: 0, el: "C", x: 1.4, y: 0.5, z: -0.2}, 
                {id: 1, el: "C", x: 0.7, y: -0.7, z: 0.2},
                {id: 2, el: "C", x: -0.7, y: -0.7, z: -0.2},
                {id: 3, el: "C", x: -1.4, y: 0.5, z: 0.2},
                {id: 4, el: "C", x: -0.7, y: 1.7, z: -0.2},
                {id: 5, el: "C", x: 0.7, y: 1.7, z: 0.2},
                {id: 6, el: "H", x: 1.4, y: 0.5, z: -1.3}, {id: 7, el: "H", x: 2.4, y: 0.5, z: 0.2},
                {id: 8, el: "H", x: 0.7, y: -0.7, z: 1.3}, {id: 9, el: "H", x: 1.2, y: -1.6, z: -0.2},
                {id: 10, el: "H", x: -0.7, y: -0.7, z: -1.3}, {id: 11, el: "H", x: -1.2, y: -1.6, z: 0.2},
                {id: 12, el: "H", x: -1.4, y: 0.5, z: 1.3}, {id: 13, el: "H", x: -2.4, y: 0.5, z: -0.2},
                {id: 14, el: "H", x: -0.7, y: 1.7, z: -1.3}, {id: 15, el: "H", x: -1.2, y: 2.6, z: 0.2},
                {id: 16, el: "H", x: 0.7, y: 1.7, z: 1.3}, {id: 17, el: "H", x: 1.2, y: 2.6, z: -0.2}
            ],
            bonds: [
                {source: 0, target: 1, type: "single"}, {source: 1, target: 2, type: "single"},
                {source: 2, target: 3, type: "single"}, {source: 3, target: 4, type: "single"},
                {source: 4, target: 5, type: "single"}, {source: 5, target: 0, type: "single"},
                {source: 0, target: 6, type: "single"}, {source: 0, target: 7, type: "single"},
                {source: 1, target: 8, type: "single"}, {source: 1, target: 9, type: "single"},
                {source: 2, target: 10, type: "single"}, {source: 2, target: 11, type: "single"},
                {source: 3, target: 12, type: "single"}, {source: 3, target: 13, type: "single"},
                {source: 4, target: 14, type: "single"}, {source: 4, target: 15, type: "single"},
                {source: 5, target: 16, type: "single"}, {source: 5, target: 17, type: "single"}
            ]
        },
        "Xenon": {
            atoms: [
                {id: 0, el: "Xe", x: -2.0, y: 0, z: 0},
                {id: 1, el: "Xe", x: 2.0, y: 0, z: 0}
            ],
            bonds: [
                {source: 0, target: 1, type: "vdw"}
            ]
        },
        "Benzaldehyde": {
            atoms: [
                { id: 0, el: "C", x: 1.4, y: 0, z: 0 }, { id: 1, el: "C", x: 0.7, y: 1.21, z: 0 },
                { id: 2, el: "C", x: -0.7, y: 1.21, z: 0 }, { id: 3, el: "C", x: -1.4, y: 0, z: 0 },
                { id: 4, el: "C", x: -0.7, y: -1.21, z: 0 }, { id: 5, el: "C", x: 0.7, y: -1.21, z: 0 },
                { id: 6, el: "C", x: -2.8, y: 0, z: 0 },
                { id: 7, el: "O", x: -3.5, y: 1.2, z: 0 },
                { id: 8, el: "H", x: -3.3, y: -1.0, z: 0 }
            ],
            bonds: [
                { source: 0, target: 1, type: "double" }, { source: 1, target: 2, type: "single" },
                { source: 2, target: 3, type: "double" }, { source: 3, target: 4, type: "single" },
                { source: 4, target: 5, type: "double" }, { source: 5, target: 0, type: "single" },
                { source: 3, target: 6, type: "single" }, { source: 6, target: 7, type: "double" },
                { source: 6, target: 8, type: "single" }
            ]
        },
        "Sodium Acetate": {
            atoms: [
                {id: 0, el: "C", x: -1.0, y: 0, z: 0},
                {id: 1, el: "C", x: 0.5, y: 0, z: 0},
                {id: 2, el: "O", x: 1.2, y: 1.2, z: 0},
                {id: 3, el: "O", x: 1.1, y: -1.2, z: 0, role: "anion"}, // Anion Oxygen
                {id: 4, el: "Na", x: 3.5, y: -1.5, z: 0, role: "cation"}, // Cation Sodium
                {id: 5, el: "H", x: -1.4, y: 1.0, z: 0}, {id: 6, el: "H", x: -1.4, y: -0.5, z: 0.9}, {id: 7, el: "H", x: -1.4, y: -0.5, z: -0.9}
            ],
            bonds: [
                {source: 0, target: 1, type: "single"},
                {source: 1, target: 2, type: "double"},
                {source: 1, target: 3, type: "single"}, 
                {source: 0, target: 5, type: "single"}, {source: 0, target: 6, type: "single"}, {source: 0, target: 7, type: "single"},
                {source: 3, target: 4, type: "ionic"}
            ]
        },
        "Tollen's Reagent": {
            atoms: [
                {id: 0, el: "Ag", x: 0, y: 0, z: 0, role: "cation"},
                {id: 1, el: "N", x: -2.1, y: 0, z: 0},
                {id: 2, el: "N", x: 2.1, y: 0, z: 0},
                {id: 3, el: "H", x: -2.5, y: 0.8, z: 0}, {id: 4, el: "H", x: -2.5, y: -0.4, z: 0.7}, {id: 5, el: "H", x: -2.5, y: -0.4, z: -0.7},
                {id: 6, el: "H", x: 2.5, y: 0.8, z: 0}, {id: 7, el: "H", x: 2.5, y: -0.4, z: 0.7}, {id: 8, el: "H", x: 2.5, y: -0.4, z: -0.7}
            ],
            bonds: [
                {source: 0, target: 1, type: "single"}, {source: 0, target: 2, type: "single"},
                {source: 1, target: 3, type: "single"}, {source: 1, target: 4, type: "single"}, {source: 1, target: 5, type: "single"},
                {source: 2, target: 6, type: "single"}, {source: 2, target: 7, type: "single"}, {source: 2, target: 8, type: "single"}
            ]
        },
        "Dextrose": {
            // C6H12O6 Linear
             atoms: [
                {id: 0, el: "C", x: 0, y: 3, z: 0}, {id: 1, el: "O", x: 1.2, y: 3.5, z: 0}, // CHO
                {id: 2, el: "C", x: 0, y: 1.5, z: 0}, {id: 3, el: "O", x: -1.4, y: 1.5, z: 0}, // CHOH
                {id: 4, el: "C", x: 0, y: 0, z: 0}, {id: 5, el: "O", x: 1.4, y: 0, z: 0}, // CHOH
                {id: 6, el: "C", x: 0, y: -1.5, z: 0}, {id: 7, el: "O", x: -1.4, y: -1.5, z: 0}, // CHOH
                {id: 8, el: "C", x: 0, y: -3, z: 0}, {id: 9, el: "O", x: 1.4, y: -3, z: 0}, // CHOH
                {id: 10, el: "C", x: 0, y: -4.5, z: 0}, {id: 11, el: "O", x: 0, y: -5.5, z: 0}, // CH2OH
                // Hydrogens (added for C6H12O6)
                {id: 12, el: "H", x: -1.0, y: 3.2, z: 0}, // C0-H
                {id: 13, el: "H", x: 1.0, y: 1.5, z: 0}, {id: 14, el: "H", x: -2.0, y: 2.0, z: 0}, // C2-H, O3-H
                {id: 15, el: "H", x: -1.0, y: 0, z: 0}, {id: 16, el: "H", x: 2.0, y: 0.5, z: 0}, // C4-H, O5-H
                {id: 17, el: "H", x: 1.0, y: -1.5, z: 0}, {id: 18, el: "H", x: -2.0, y: -1.0, z: 0}, // C6-H, O7-H
                {id: 19, el: "H", x: -1.0, y: -3, z: 0}, {id: 20, el: "H", x: 2.0, y: -2.5, z: 0}, // C8-H, O9-H
                {id: 21, el: "H", x: -1.0, y: -4.5, z: 0.5}, {id: 22, el: "H", x: 1.0, y: -4.5, z: -0.5}, {id: 23, el: "H", x: 0.5, y: -6.0, z: 0} // C10-H2, O11-H
            ],
            bonds: [
                {source: 0, target: 1, type: "double"}, {source: 0, target: 2, type: "single"}, {source: 0, target: 12, type: "single"},
                {source: 2, target: 3, type: "single"}, {source: 2, target: 4, type: "single"}, {source: 2, target: 13, type: "single"}, {source: 3, target: 14, type: "single"},
                {source: 4, target: 5, type: "single"}, {source: 4, target: 6, type: "single"}, {source: 4, target: 15, type: "single"}, {source: 5, target: 16, type: "single"},
                {source: 6, target: 7, type: "single"}, {source: 6, target: 8, type: "single"}, {source: 6, target: 17, type: "single"}, {source: 7, target: 18, type: "single"},
                {source: 8, target: 9, type: "single"}, {source: 8, target: 10, type: "single"}, {source: 8, target: 19, type: "single"}, {source: 9, target: 20, type: "single"},
                {source: 10, target: 11, type: "single"}, {source: 10, target: 21, type: "single"}, {source: 10, target: 22, type: "single"}, {source: 11, target: 23, type: "single"}
            ]
        },
        "Glucopyranose": {
             // C6H12O6 Ring
             atoms: [
                 {id: 0, el: "O", x: 1.2, y: 0.7, z: 0}, // Ring O
                 {id: 1, el: "C", x: 1.2, y: -0.7, z: 0}, // C1
                 {id: 2, el: "C", x: 0, y: -1.4, z: 0},   // C2
                 {id: 3, el: "C", x: -1.2, y: -0.7, z: 0},// C3
                 {id: 4, el: "C", x: -1.2, y: 0.7, z: 0}, // C4
                 {id: 5, el: "C", x: 0, y: 1.4, z: 0},    // C5
                 {id: 6, el: "C", x: 0, y: 2.8, z: 0},    // C6 (CH2OH)
                 {id: 7, el: "O", x: 1.2, y: 2.8, z: 0},  // O on C6
                 // Substituents
                 {id: 8, el: "O", x: 2.3, y: -1.0, z: 0}, // OH on C1
                 {id: 9, el: "O", x: 0, y: -2.6, z: 0},   // OH on C2
                 {id: 10, el: "O", x: -2.3, y: -1.0, z: 0},// OH on C3
                 {id: 11, el: "O", x: -2.3, y: 1.0, z: 0}, // OH on C4
                 // Hydrogens (Simplified positions)
                 {id: 12, el: "H", x: 2.8, y: -0.5, z: 0}, // OH-H C1
                 {id: 13, el: "H", x: 0.5, y: -3.0, z: 0}, // OH-H C2
                 {id: 14, el: "H", x: -2.8, y: -0.5, z: 0},// OH-H C3
                 {id: 15, el: "H", x: -2.8, y: 1.5, z: 0}, // OH-H C4
                 {id: 16, el: "H", x: 1.8, y: 3.2, z: 0},  // OH-H C6
                 {id: 17, el: "H", x: 0.5, y: -0.5, z: 1.0}, // H on C1
                 {id: 18, el: "H", x: -0.5, y: -1.0, z: 1.0},// H on C2
                 {id: 19, el: "H", x: -0.8, y: -0.5, z: 1.0},// H on C3
                 {id: 20, el: "H", x: -0.8, y: 0.5, z: 1.0}, // H on C4
                 {id: 21, el: "H", x: 0, y: 1.2, z: 1.2},    // H on C5
                 {id: 22, el: "H", x: -0.8, y: 2.8, z: 0.5}, // H1 on C6
                 {id: 23, el: "H", x: 0.5, y: 2.8, z: -0.8}  // H2 on C6
             ],
             bonds: [
                 {source: 0, target: 1, type: "single"}, {source: 1, target: 2, type: "single"},
                 {source: 2, target: 3, type: "single"}, {source: 3, target: 4, type: "single"},
                 {source: 4, target: 5, type: "single"}, {source: 5, target: 0, type: "single"},
                 {source: 5, target: 6, type: "single"}, {source: 6, target: 7, type: "single"},
                 {source: 1, target: 8, type: "single"}, {source: 8, target: 12, type: "single"},
                 {source: 2, target: 9, type: "single"}, {source: 9, target: 13, type: "single"},
                 {source: 3, target: 10, type: "single"}, {source: 10, target: 14, type: "single"},
                 {source: 4, target: 11, type: "single"}, {source: 11, target: 15, type: "single"},
                 {source: 7, target: 16, type: "single"},
                 {source: 1, target: 17, type: "single"}, {source: 2, target: 18, type: "single"},
                 {source: 3, target: 19, type: "single"}, {source: 4, target: 20, type: "single"},
                 {source: 5, target: 21, type: "single"},
                 {source: 6, target: 22, type: "single"}, {source: 6, target: 23, type: "single"}
             ]
        }
      };

      const ELEMENT_COLORS = {
        "C": 0x333333, "H": 0xFFFFFF, "O": 0xFF0000, "N": 0x0000FF, 
        "Ag": 0xC0C0C0, "Na": 0x800080, "Xe": 0x00FFFF
      };

      const ELEMENT_RADII = {
        "C": 0.4, "H": 0.25, "O": 0.35, "N": 0.38, "Ag": 0.5, "Na": 0.5, "Xe": 0.5
      };

      const ATOMIC_MASSES = {
        "H": 1.008, "C": 12.011, "N": 14.007, "O": 15.999, "Na": 22.990, "Ag": 107.868, "Xe": 131.293
      };

      // --- Helper Components ---

      const GradientText = ({ children }) => (
        <span className="text-transparent bg-clip-text bg-gradient-to-r from-primary via-cyan-300 to-secondary font-bold">
            {children}
        </span>
      );

      // --- 3D Molecular Viewer Component ---
      const MolecularViewer = ({ onClose }) => {
        const mountRef = useRef(null);
        const [selectedMoleculeName, setSelectedMoleculeName] = useState("Benzene");
        const [searchQuery, setSearchQuery] = useState("");
        const [showPi, setShowPi] = useState(false);
        const [showTau, setShowTau] = useState(false);
        const [showIonic, setShowIonic] = useState(true);
        const [showVDW, setShowVDW] = useState(true);
        const [error, setError] = useState(null);
        
        // Refs for raycasting logic
        const raycaster = useRef(new THREE.Raycaster());
        const atomWrappers = useRef([]); // Stores { mesh, sprite } pairs
        const atomMeshes = useRef([]);   // Stores meshes for intersection

        // Filter molecules
        const moleculeList = useMemo(() => {
            return Object.keys(MOLECULES).filter(name => 
                name.toLowerCase().includes(searchQuery.toLowerCase())
            );
        }, [searchQuery]);

        // Calculate Formula and Mass
        const moleculeInfo = useMemo(() => {
            const data = MOLECULES[selectedMoleculeName];
            if (!data) return { formula: "", mass: 0 };
            
            let mass = 0;
            const counts = {};
            data.atoms.forEach(a => {
                counts[a.el] = (counts[a.el] || 0) + 1;
                mass += (ATOMIC_MASSES[a.el] || 0);
            });
            
            // Format formula C H O N etc
            const order = ["C", "H", "O", "N", "Na", "Ag", "Xe"];
            let formula = "";
            order.forEach(el => {
                if (counts[el]) {
                    formula += el + (counts[el] > 1 ? counts[el] : "");
                }
            });
            // catch remaining
            Object.keys(counts).forEach(el => {
                if (!order.includes(el)) formula += el + (counts[el] > 1 ? counts[el] : "");
            });

            return { formula, mass: mass.toFixed(2) };
        }, [selectedMoleculeName]);

        useEffect(() => {
            // Safety check for Three.js
            if (!window.THREE) {
                setError("Three.js library failed to load.");
                return;
            }
            if (!mountRef.current) return;

            let renderer, scene, camera, controls, animId;

            try {
                // Three.js Setup
                const width = mountRef.current.clientWidth;
                const height = mountRef.current.clientHeight;
                
                scene = new THREE.Scene();
                // Background is handled by CSS, keep scene transparent or dark
                scene.background = null; 
                
                // Fog for depth
                scene.fog = new THREE.Fog(0x111111, 5, 25);

                camera = new THREE.PerspectiveCamera(50, width / height, 0.1, 100);
                camera.position.z = 8;
                camera.position.y = 2;

                renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
                renderer.setSize(width, height);
                mountRef.current.appendChild(renderer.domElement);

                // Check OrbitControls
                if (THREE.OrbitControls) {
                    controls = new THREE.OrbitControls(camera, renderer.domElement);
                    controls.enableDamping = true;
                    controls.dampingFactor = 0.05;
                    // Configure controls for Middle Mouse Pan
                    controls.enablePan = true;
                    controls.screenSpacePanning = true; 
                    controls.mouseButtons = {
                        LEFT: THREE.MOUSE.ROTATE,
                        MIDDLE: THREE.MOUSE.PAN,
                        RIGHT: THREE.MOUSE.DOLLY
                    };
                } else {
                    console.warn("OrbitControls not loaded.");
                }

                // Lights
                const ambientLight = new THREE.AmbientLight(0x404040, 2);
                scene.add(ambientLight);
                
                const pointLight = new THREE.PointLight(0xffffff, 1, 100);
                pointLight.position.set(10, 10, 10);
                scene.add(pointLight);
                
                const pointLight2 = new THREE.PointLight(0x06bcf9, 0.5, 100);
                pointLight2.position.set(-10, -10, 5);
                scene.add(pointLight2);

                // Group to hold molecule
                const moleculeGroup = new THREE.Group();
                scene.add(moleculeGroup);

                // Helper to create text sprite
                const createTextSprite = (message, color) => {
                    const canvas = document.createElement('canvas');
                    const context = canvas.getContext('2d');
                    canvas.width = 128; // Increased size for charge symbols
                    canvas.height = 128;
                    context.font = "Bold 40px Arial";
                    context.fillStyle = "rgba(0,0,0,1)";
                    context.strokeStyle = color;
                    context.lineWidth = 2;
                    context.textAlign = "center";
                    context.textBaseline = "middle";
                    // Stroke text for outline
                    context.strokeText(message, 64, 64);
                    context.fillStyle = "white";
                    context.fillText(message, 64, 64);
                    
                    const texture = new THREE.CanvasTexture(canvas);
                    const spriteMaterial = new THREE.SpriteMaterial({ 
                        map: texture,
                        depthTest: false // Render on top of own atom (we handle other occlusion via raycast)
                    });
                    const sprite = new THREE.Sprite(spriteMaterial);
                    sprite.renderOrder = 999; 
                    sprite.scale.set(0.5, 0.5, 0.5);
                    return sprite;
                }

                // Helper to create 3D Cage
                const createIonicCage = (radius, color) => {
                    const s = radius * 1.6; // Size box
                    const d = s * 0.4; // Corner line length
                    const geometry = new THREE.BufferGeometry();
                    const vertices = [];

                    // 8 Corners of a cube
                    const corners = [
                        [s, s, s], [s, s, -s], [s, -s, s], [s, -s, -s],
                        [-s, s, s], [-s, s, -s], [-s, -s, s], [-s, -s, -s]
                    ];

                    corners.forEach(([x, y, z]) => {
                        // Line parallel to X
                        vertices.push(x, y, z);
                        vertices.push(x > 0 ? x - d : x + d, y, z);
                        // Line parallel to Y
                        vertices.push(x, y, z);
                        vertices.push(x, y > 0 ? y - d : y + d, z);
                        // Line parallel to Z
                        vertices.push(x, y, z);
                        vertices.push(x, y, z > 0 ? z - d : z + d);
                    });

                    geometry.setAttribute('position', new THREE.Float32BufferAttribute(vertices, 3));
                    const material = new THREE.LineBasicMaterial({ 
                        color: color, 
                        depthTest: false, // Always on top
                        transparent: true,
                        opacity: 0.8,
                        linewidth: 2 
                    });
                    const cage = new THREE.LineSegments(geometry, material);
                    cage.renderOrder = 998; // Just below text
                    return cage;
                }

                // Render Molecule Function
                const renderMolecule = () => {
                    while(moleculeGroup.children.length > 0){ 
                        moleculeGroup.remove(moleculeGroup.children[0]); 
                    }
                    
                    // Clear refs
                    atomWrappers.current = [];
                    atomMeshes.current = [];

                    const data = MOLECULES[selectedMoleculeName];
                    if(!data) return;

                    // Create Atoms
                    data.atoms.forEach(atom => {
                        const radius = ELEMENT_RADII[atom.el] || 0.3;
                        const color = ELEMENT_COLORS[atom.el] || 0xffffff;
                        const geometry = new THREE.SphereGeometry(radius, 32, 32);
                        const material = new THREE.MeshPhysicalMaterial({ 
                            color: color,
                            roughness: 0.3,
                            metalness: 0.2,
                            clearcoat: 0.8
                        });
                        const sphere = new THREE.Mesh(geometry, material);
                        sphere.position.set(atom.x, atom.y, atom.z);
                        moleculeGroup.add(sphere);

                        // Label Logic
                        let label = atom.el;
                        let hasCharge = false;
                        
                        if (showIonic && atom.role) {
                            hasCharge = true;
                            label += (atom.role === "cation" ? "+" : "-");
                            
                            // Add Cage
                            const cageColor = atom.role === "cation" ? 0x0088ff : 0xff0044;
                            const cage = createIonicCage(radius, cageColor);
                            cage.position.set(atom.x, atom.y, atom.z);
                            moleculeGroup.add(cage);
                        }

                        // Add Label
                        const sprite = createTextSprite(label, '#' + new THREE.Color(color).getHexString());
                        sprite.position.set(atom.x, atom.y, atom.z);
                        moleculeGroup.add(sprite);
                        
                        // Store for update loop
                        atomWrappers.current.push({ mesh: sphere, sprite: sprite });
                        atomMeshes.current.push(sphere);
                    });

                    // Create Bonds
                    data.bonds.forEach(bond => {
                        const source = data.atoms[bond.source];
                        const target = data.atoms[bond.target];
                        const start = new THREE.Vector3(source.x, source.y, source.z);
                        const end = new THREE.Vector3(target.x, target.y, target.z);
                        const distance = start.distanceTo(end);
                        const mid = new THREE.Vector3().addVectors(start, end).multiplyScalar(0.5);
                        
                        if (bond.type === 'ionic') {
                            if (!showIonic) return;
                            const lineGeo = new THREE.BufferGeometry().setFromPoints([start, end]);
                            const lineMat = new THREE.LineDashedMaterial({ 
                                color: 0xffff00, 
                                dashSize: 0.2, 
                                gapSize: 0.1,
                                scale: 1 
                            });
                            const line = new THREE.Line(lineGeo, lineMat);
                            line.computeLineDistances();
                            moleculeGroup.add(line);
                        } else if (bond.type === 'vdw') {
                            if (!showVDW) return;
                            const lineGeo = new THREE.BufferGeometry().setFromPoints([start, end]);
                            const lineMat = new THREE.LineDashedMaterial({ 
                                color: 0x00ffff, 
                                dashSize: 0.05, 
                                gapSize: 0.1,
                                scale: 1,
                                opacity: 0.5,
                                transparent: true
                            });
                            const line = new THREE.Line(lineGeo, lineMat);
                            line.computeLineDistances();
                            moleculeGroup.add(line);
                        } else if (showTau && bond.type === 'double') {
                             // Tau / Bent Bonds
                             const curveHeight = 0.3;
                             const createBentBond = (offsetScaler) => {
                                 const path = new THREE.QuadraticBezierCurve3(
                                     start,
                                     new THREE.Vector3(mid.x, mid.y + offsetScaler, mid.z + offsetScaler), // Control point
                                     end
                                 );
                                 const tubeGeo = new THREE.TubeGeometry(path, 8, 0.08, 8, false);
                                 const tubeMat = new THREE.MeshStandardMaterial({ color: 0xaaaaaa });
                                 const tube = new THREE.Mesh(tubeGeo, tubeMat);
                                 moleculeGroup.add(tube);
                             };
                             createBentBond(curveHeight);
                             createBentBond(-curveHeight);

                        } else {
                            // Sigma Bond (Standard)
                            const direction = new THREE.Vector3().subVectors(end, start);
                            const orientation = new THREE.Matrix4();
                            orientation.lookAt(start, end, new THREE.Object3D().up);
                            orientation.multiply(new THREE.Matrix4().makeRotationX(Math.PI / 2));
                            
                            const cylinderGeo = new THREE.CylinderGeometry(0.1, 0.1, distance, 12);
                            const cylinderMat = new THREE.MeshStandardMaterial({ color: 0x888888 });
                            const cylinder = new THREE.Mesh(cylinderGeo, cylinderMat);
                            cylinder.applyMatrix4(orientation);
                            cylinder.position.copy(mid);
                            moleculeGroup.add(cylinder);

                            // If double bond and NOT Tau, show simplified Pi lines
                            if (bond.type === 'double' && !showTau) {
                                 const cylinder2 = new THREE.Mesh(new THREE.CylinderGeometry(0.05, 0.05, distance, 12), new THREE.MeshStandardMaterial({ color: 0xffffff }));
                                 cylinder2.applyMatrix4(orientation);
                                 cylinder2.position.copy(mid);
                                 cylinder2.position.x += 0.15;
                                 moleculeGroup.add(cylinder2);
                            }
                        }

                        // Pi Orbitals Visualization
                        if (showPi && bond.type === 'double') {
                            const createLobe = (pos, isUp) => {
                                const lobeGeo = new THREE.SphereGeometry(0.3, 16, 16);
                                lobeGeo.scale(0.5, 1, 0.5);
                                const lobeMat = new THREE.MeshPhongMaterial({ 
                                    color: isUp ? 0x0000ff : 0xff0000, 
                                    transparent: true, 
                                    opacity: 0.4,
                                    side: THREE.DoubleSide
                                });
                                const lobe = new THREE.Mesh(lobeGeo, lobeMat);
                                lobe.position.set(pos.x, pos.y + (isUp ? 0.5 : -0.5), pos.z + 0.2);
                                moleculeGroup.add(lobe);
                            };
                            createLobe(source, true);
                            createLobe(source, false);
                            createLobe(target, true);
                            createLobe(target, false);
                        }
                    });
                };

                renderMolecule();

                // Animation Loop
                const animate = () => {
                    animId = requestAnimationFrame(animate);
                    if (controls) controls.update();
                    
                    // Handle text occlusion
                    if (atomWrappers.current.length > 0) {
                        const camPos = camera.position;
                        const dir = new THREE.Vector3();
                        
                        atomWrappers.current.forEach(({ mesh, sprite }) => {
                            dir.subVectors(mesh.position, camPos).normalize();
                            raycaster.current.set(camPos, dir);
                            
                            const intersects = raycaster.current.intersectObjects(atomMeshes.current);
                            
                            if (intersects.length > 0) {
                                if (intersects[0].object === mesh) {
                                    sprite.visible = true;
                                } else {
                                    sprite.visible = false;
                                }
                            } else {
                                sprite.visible = true;
                            }
                        });
                    }

                    renderer.render(scene, camera);
                };
                animate();

            } catch (e) {
                console.error("3D Viewer crashed:", e);
                setError(e.message);
            }

            // Cleanup
            return () => {
                if (animId) cancelAnimationFrame(animId);
                if (mountRef.current && renderer) {
                    mountRef.current.removeChild(renderer.domElement);
                }
                if (renderer) renderer.dispose();
            };
        }, [selectedMoleculeName, showPi, showTau, showIonic, showVDW]);

        if (error) {
            return (
                <div className="fixed inset-0 z-[100] flex items-center justify-center bg-black/95 text-white">
                    <div className="text-center">
                        <h2 className="text-xl font-bold text-red-500 mb-4">Viewer Error</h2>
                        <p className="mb-4">{error}</p>
                        <button onClick={onClose} className="px-4 py-2 bg-slate-700 rounded hover:bg-slate-600">Close</button>
                    </div>
                </div>
            );
        }

        return (
            <div className="fixed inset-0 z-[100] flex bg-black/95 backdrop-blur-xl animate-in fade-in duration-300">
                {/* Sidebar */}
                <div className="w-80 border-r border-white/10 bg-[#0a0f14] flex flex-col p-6 z-10 shrink-0">
                    <button onClick={onClose} className="mb-6 flex items-center gap-2 text-slate-400 hover:text-white transition-colors">
                        <span className="material-symbols-outlined">arrow_back</span> Back to Portfolio
                    </button>
                    
                    <h2 className="text-2xl font-bold text-white mb-2">Molecular<br/><span className="text-primary">Viewer</span></h2>
                    
                    <div className="relative mb-6">
                        <span className="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-slate-500 text-sm">search</span>
                        <input 
                            type="text" 
                            placeholder="Search chemical..." 
                            value={searchQuery}
                            onChange={(e) => setSearchQuery(e.target.value)}
                            className="w-full bg-black/50 border border-white/10 rounded-lg py-2 pl-9 pr-4 text-sm text-white focus:outline-none focus:border-primary"
                        />
                    </div>

                    <div className="flex-1 overflow-y-auto molecule-scroll pr-2 space-y-2 mb-6">
                        {moleculeList.map(name => (
                            <button
                                key={name}
                                onClick={() => setSelectedMoleculeName(name)}
                                className={`w-full text-left px-4 py-3 rounded-lg text-sm transition-all flex justify-between items-center ${selectedMoleculeName === name ? 'bg-primary/20 text-primary border border-primary/50' : 'text-slate-400 hover:bg-white/5 hover:text-white'}`}
                            >
                                {name}
                                {selectedMoleculeName === name && <span className="material-symbols-outlined text-xs">hexagon</span>}
                            </button>
                        ))}
                    </div>

                    <div className="border-t border-white/10 pt-6 space-y-4">
                        <h3 className="text-xs font-bold text-slate-500 uppercase tracking-widest">Bond Visualization</h3>
                        
                        <label className="flex items-center justify-between cursor-pointer group">
                            <span className="text-sm text-slate-300 group-hover:text-white">Pi Orbitals</span>
                            <div onClick={() => setShowPi(!showPi)} className={`w-10 h-5 rounded-full relative transition-colors ${showPi ? 'bg-secondary' : 'bg-slate-700'}`}>
                                <div className={`absolute top-1 left-1 w-3 h-3 bg-white rounded-full transition-transform ${showPi ? 'translate-x-5' : ''}`} />
                            </div>
                        </label>

                        <label className="flex items-center justify-between cursor-pointer group">
                            <span className="text-sm text-slate-300 group-hover:text-white">Tau / Bent Bonds</span>
                            <div onClick={() => setShowTau(!showTau)} className={`w-10 h-5 rounded-full relative transition-colors ${showTau ? 'bg-primary' : 'bg-slate-700'}`}>
                                <div className={`absolute top-1 left-1 w-3 h-3 bg-white rounded-full transition-transform ${showTau ? 'translate-x-5' : ''}`} />
                            </div>
                        </label>
                        
                        <label className="flex items-center justify-between cursor-pointer group">
                            <span className="text-sm text-slate-300 group-hover:text-white">Ionic Bonds</span>
                            <div onClick={() => setShowIonic(!showIonic)} className={`w-10 h-5 rounded-full relative transition-colors ${showIonic ? 'bg-yellow-500' : 'bg-slate-700'}`}>
                                <div className={`absolute top-1 left-1 w-3 h-3 bg-white rounded-full transition-transform ${showIonic ? 'translate-x-5' : ''}`} />
                            </div>
                        </label>

                         <label className="flex items-center justify-between cursor-pointer group">
                            <span className="text-sm text-slate-300 group-hover:text-white">Van der Waals</span>
                            <div onClick={() => setShowVDW(!showVDW)} className={`w-10 h-5 rounded-full relative transition-colors ${showVDW ? 'bg-cyan-400' : 'bg-slate-700'}`}>
                                <div className={`absolute top-1 left-1 w-3 h-3 bg-white rounded-full transition-transform ${showVDW ? 'translate-x-5' : ''}`} />
                            </div>
                        </label>
                    </div>
                </div>

                {/* Main 3D View */}
                <div className="flex-1 relative bg-gradient-to-br from-gray-900 to-black">
                    <div ref={mountRef} className="w-full h-full cursor-move" />
                    
                    {/* Top Left Info Panel */}
                    <div className="absolute top-6 left-6 p-4 rounded-xl bg-black/40 backdrop-blur border border-white/10 pointer-events-none z-20">
                         <h2 className="text-2xl font-bold text-white mb-1">{selectedMoleculeName}</h2>
                         <div className="flex flex-col gap-1 text-sm font-mono text-slate-300">
                             <div>Formula: <span className="text-primary">{moleculeInfo.formula}</span></div>
                             <div>Molar Mass: <span className="text-secondary">{moleculeInfo.mass} g/mol</span></div>
                         </div>
                    </div>

                    {/* Legend */}
                    <div className="absolute bottom-6 right-6 bg-black/60 backdrop-blur p-4 rounded-xl border border-white/10 pointer-events-none">
                        <div className="flex gap-4 text-xs font-mono">
                            <div className="flex items-center gap-2"><span className="w-3 h-3 rounded-full bg-[#333333] border border-white/20"></span> C</div>
                            <div className="flex items-center gap-2"><span className="w-3 h-3 rounded-full bg-white"></span> H</div>
                            <div className="flex items-center gap-2"><span className="w-3 h-3 rounded-full bg-red-600"></span> O</div>
                            <div className="flex items-center gap-2"><span className="w-3 h-3 rounded-full bg-blue-600"></span> N</div>
                            <div className="flex items-center gap-2"><span className="w-3 h-3 rounded-full bg-purple-600"></span> Na</div>
                            <div className="flex items-center gap-2"><span className="w-3 h-3 rounded-full bg-cyan-400"></span> Xe</div>
                        </div>
                    </div>
                </div>
            </div>
        );
      };

      const BlackHoleBackground = ({ progress }) => {
        const canvasRef = useRef(null);
        const angleRef = useRef(0);

        useEffect(() => {
          const canvas = canvasRef.current;
          const ctx = canvas.getContext('2d');
          
          const render = () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            const w = canvas.width;
            const h = canvas.height;
            const cx = w / 2;
            const cy = h / 2;

            ctx.fillStyle = '#020204';
            ctx.fillRect(0, 0, w, h);

            // Stars
            for(let i=0; i<150; i++) {
                const x = (Math.sin(i * 123.456) * 9999) % w;
                const y = (Math.cos(i * 654.321) * 9999) % h;
                const size = (Math.sin(i) + 1.5) * 0.8;
                const opacity = (Math.cos(i) + 1) * 0.3 + 0.1;
                ctx.fillStyle = `rgba(255,255,255,${Math.abs(opacity)})`;
                ctx.beginPath();
                ctx.arc(Math.abs(x), Math.abs(y), size, 0, Math.PI * 2);
                ctx.fill();
            }

            const p = progress;
            const merged = p > 0.98;
            const maxSep = Math.min(w, h) * 0.25;
            const currentOrbitRadius = merged ? 0 : (maxSep/2) * (1 - p);
            const rotationSpeed = 0.02 + (Math.pow(p, 3) * 0.15);
            angleRef.current += rotationSpeed;
            const angle = angleRef.current;

            ctx.save();
            ctx.translate(cx, cy);

            if (!merged) {
                const numRings = 8;
                const maxRad = Math.max(w, h) * 0.6;
                const time = Date.now() / 1000;
                ctx.save();
                ctx.rotate(angle * 0.2); 
                for(let i=0; i<numRings; i++) {
                    const waveBase = (i / numRings);
                    const waveOffset = (time * (0.1 + p * 0.4)) % 1; 
                    const waveR = ((waveBase + waveOffset) % 1) * maxRad;
                    const fade = 1 - (waveR / maxRad);
                    const intensity = (p * 0.6 + 0.1) * fade;
                    ctx.strokeStyle = `rgba(100, 100, 255, ${intensity})`;
                    ctx.lineWidth = 1 + p * 5 * fade;
                    ctx.beginPath();
                    ctx.ellipse(0, 0, waveR, waveR * (1 - p * 0.1), angle * -1, 0, Math.PI * 2);
                    ctx.stroke();
                }
                ctx.restore();
            } else {
                const shockTime = (Date.now() / 20) % 200;
                ctx.strokeStyle = `rgba(255, 255, 255, ${0.3 * (1 - shockTime/200)})`;
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.arc(0, 0, shockTime * 5, 0, Math.PI * 2);
                ctx.stroke();
            }

            const drawSingleBH = (x, y, r, color, isMergedEntity) => {
                const diskRadius = r * (isMergedEntity ? 5 : 3);
                const grad = ctx.createRadialGradient(x, y, r * 0.8, x, y, diskRadius);
                grad.addColorStop(0, '#000'); 
                grad.addColorStop(0.2, color); 
                grad.addColorStop(1, 'transparent'); 

                ctx.fillStyle = grad;
                ctx.beginPath();
                ctx.arc(x, y, diskRadius, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = isMergedEntity ? 4 : 2;
                ctx.shadowColor = color;
                ctx.shadowBlur = isMergedEntity ? 30 : 15;
                ctx.beginPath();
                ctx.arc(x, y, r, 0, Math.PI * 2);
                ctx.stroke();
                ctx.shadowBlur = 0;

                ctx.fillStyle = '#000';
                ctx.beginPath();
                ctx.arc(x, y, r * 0.95, 0, Math.PI * 2);
                ctx.fill();
            };

            const baseRadius = 20;

            if (merged) {
                const shake = (Math.random() - 0.5) * 3;
                drawSingleBH(shake, shake, baseRadius * 1.6, 'rgba(150, 200, 255, 0.9)', true);
                
                ctx.save();
                ctx.rotate(Math.PI / 4);
                ctx.strokeStyle = 'rgba(6, 188, 249, 0.4)';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(0, -baseRadius * 2);
                ctx.lineTo(0, -baseRadius * 20 - Math.random()*50);
                ctx.moveTo(0, baseRadius * 2);
                ctx.lineTo(0, baseRadius * 20 + Math.random()*50);
                ctx.stroke();
                ctx.restore();

            } else {
                const x1 = Math.cos(angle) * currentOrbitRadius;
                const y1 = Math.sin(angle) * currentOrbitRadius;
                const x2 = Math.cos(angle + Math.PI) * currentOrbitRadius;
                const y2 = Math.sin(angle + Math.PI) * currentOrbitRadius;

                drawSingleBH(x1, y1, baseRadius, 'rgba(6, 188, 249, 0.8)', false);
                drawSingleBH(x2, y2, baseRadius, 'rgba(168, 85, 247, 0.8)', false);

                if (p > 0.5) {
                    ctx.save();
                    ctx.beginPath();
                    ctx.moveTo(x1 * 0.8, y1 * 0.8);
                    const cpX = (Math.random()-0.5) * 10;
                    const cpY = (Math.random()-0.5) * 10;
                    ctx.quadraticCurveTo(cpX, cpY, x2 * 0.8, y2 * 0.8);
                    ctx.strokeStyle = `rgba(255, 255, 255, ${p * 0.8})`;
                    ctx.lineWidth = p * 6;
                    ctx.lineCap = 'round';
                    ctx.stroke();
                    ctx.restore();
                }
            }

            ctx.restore();
          };

          const animId = requestAnimationFrame(function loop() {
              render();
              requestAnimationFrame(loop);
          });

          const handleResize = () => render();
          window.addEventListener('resize', handleResize);

          return () => {
            window.removeEventListener('resize', handleResize);
            cancelAnimationFrame(animId);
          };
        }, [progress]);

        return <canvas ref={canvasRef} className="absolute inset-0 z-0 h-full w-full object-cover" />;
      };

      const Navbar = () => {
        const [isOpen, setIsOpen] = useState(false);
        const [scrolled, setScrolled] = useState(false);

        useEffect(() => {
          const handleScroll = () => {
            setScrolled(window.scrollY > 20);
          };
          window.addEventListener('scroll', handleScroll);
          return () => window.removeEventListener('scroll', handleScroll);
        }, []);

        return (
          <nav className={`fixed top-0 z-50 w-full border-b transition-colors duration-300 ${scrolled ? 'border-white/5 bg-background-dark/90 backdrop-blur-md' : 'border-transparent bg-transparent'}`}>
            <div className="mx-auto flex h-16 max-w-7xl items-center justify-between px-6 lg:px-8">
              <div className="flex items-center gap-4">
                <div 
                  className="h-10 w-10 rounded-full bg-cover bg-center ring-2 ring-primary/50 shadow-neon"
                  style={{ backgroundImage: `url('${PROFILE_AVATAR}')` }}
                  aria-label="Portrait of Thanh Huy"
                />
                <span className="text-lg font-bold tracking-tight text-white hidden sm:block">Thanh Huy</span>
              </div>
              
              <div className="hidden md:flex items-center gap-8">
                {NAV_ITEMS.map((item) => (
                  <a 
                    key={item.label} 
                    href={item.href} 
                    className="text-sm font-medium text-slate-300 hover:text-primary transition-colors"
                  >
                    {item.label}
                  </a>
                ))}
              </div>

              <button 
                onClick={() => setIsOpen(!isOpen)}
                className="md:hidden p-2 text-slate-300 hover:text-white"
              >
                <span className="material-symbols-outlined">{isOpen ? 'close' : 'menu'}</span>
              </button>
            </div>

            {/* Mobile Menu */}
            {isOpen && (
              <div className="md:hidden absolute top-16 left-0 w-full bg-background-dark/95 border-b border-white/5 backdrop-blur-md py-4">
                <div className="flex flex-col items-center gap-4">
                  {NAV_ITEMS.map((item) => (
                    <a 
                      key={item.label}
                      href={item.href}
                      onClick={() => setIsOpen(false)}
                      className="text-base font-medium text-slate-300 hover:text-primary transition-colors"
                    >
                      {item.label}
                    </a>
                  ))}
                </div>
              </div>
            )}
          </nav>
        );
      };

      const Hero = () => {
        const [timeData, setTimeData] = useState(100); // Start merged (100)
        const [isControlOpen, setIsControlOpen] = useState(true);

        return (
          <section id="home" className="relative flex min-h-[90vh] flex-col items-center justify-center overflow-hidden px-4 sm:px-6 bg-[#020204]">
            
            {/* Background Simulation */}
            <BlackHoleBackground progress={timeData / 100} />

            {/* Content Gradient Overlay to ensure text readability */}
            <div className="absolute inset-0 z-0 bg-gradient-to-t from-background-dark via-transparent to-background-dark/50 pointer-events-none"></div>

            <div className="relative z-10 mx-auto max-w-5xl text-center mt-10 pointer-events-none">
              <p className="mb-4 text-xs font-bold uppercase tracking-[0.2em] text-primary/80">2026 Portfolio</p>
              <h1 className="mb-6 text-5xl font-black leading-tight tracking-tight text-white sm:text-7xl lg:text-8xl drop-shadow-2xl">
                Atomizing the <span className="text-transparent bg-clip-text bg-gradient-to-r from-primary via-cyan-300 to-white">Celestial</span> <br/>
                <span className="text-transparent bg-clip-text bg-gradient-to-r from-secondary via-purple-400 to-white">Bodies</span>
              </h1>
              <p className="mx-auto mb-10 max-w-2xl text-lg font-light leading-relaxed text-slate-300 sm:text-xl drop-shadow-md">
                I'm <span className="text-white font-medium">Thanh Huy</span>. I am a student who is dedicated to <GradientText>chemistry and astronomy</GradientText>. I use my coding skills to create digital experiences.
              </p>
            </div>
              
            <div className="relative z-20 flex flex-col sm:flex-row gap-4 justify-center items-center">
              <a href="#projects" className="group relative flex h-12 items-center justify-center overflow-hidden rounded-full bg-primary px-8 text-sm font-bold text-[#020204] transition-all hover:bg-cyan-300 hover:shadow-neon">
                <span className="relative z-10 mr-2">Explore Universe</span>
                <span className="material-symbols-outlined relative z-10 text-[20px] transition-transform group-hover:translate-x-1">rocket_launch</span>
              </a>
              <a href="#contact" className="flex h-12 items-center justify-center rounded-full border border-slate-700 px-8 text-sm font-bold text-white transition-colors hover:border-secondary hover:text-secondary hover:shadow-neon-purple bg-surface-dark/50 backdrop-blur-sm">
                Contact Me
              </a>
            </div>

            {/* Minimizable Time Control Bar */}
            <div className="absolute bottom-10 left-0 right-0 mx-auto w-full max-w-md z-30 px-6 flex justify-center">
                {isControlOpen ? (
                  <div className="w-full bg-surface-dark/60 backdrop-blur-md p-4 rounded-xl border border-white/10 shadow-2xl animate-in fade-in slide-in-from-bottom-4 duration-500">
                      <div className="flex justify-between items-center mb-3">
                          <div className="flex justify-between text-[10px] text-primary uppercase font-mono tracking-widest gap-4">
                              <span>Binary System</span>
                              <span>Singularity</span>
                          </div>
                          <button 
                            onClick={() => setIsControlOpen(false)}
                            className="text-slate-400 hover:text-white transition-colors"
                            title="Minimize Controls"
                          >
                            <span className="material-symbols-outlined text-sm">remove</span>
                          </button>
                      </div>
                      <input 
                          type="range" 
                          min="0" 
                          max="100" 
                          value={timeData} 
                          onChange={(e) => setTimeData(Number(e.target.value))}
                          className="range-slider"
                      />
                      <div className="flex justify-between items-center mt-2">
                           <span className="text-[10px] text-slate-400 font-mono">T-Minus: {(100 - timeData).toFixed(0)} units</span>
                           <span className={`text-[10px] font-mono transition-colors ${timeData > 95 ? 'text-red-500 animate-pulse font-bold' : 'text-slate-500'}`}>
                              {timeData > 95 ? 'CRITICAL: MERGER IMMINENT' : 'STATUS: STABLE ORBIT'}
                           </span>
                      </div>
                  </div>
                ) : (
                  <button 
                    onClick={() => setIsControlOpen(true)}
                    className="flex items-center gap-2 bg-surface-dark/40 backdrop-blur-sm border border-white/10 hover:border-primary/50 text-slate-300 hover:text-white px-4 py-2 rounded-full transition-all shadow-lg hover:shadow-neon"
                  >
                    <span className="material-symbols-outlined text-sm">tune</span>
                    <span className="text-xs font-bold uppercase tracking-wider">Initialize Controls</span>
                  </button>
                )}
            </div>
          </section>
        );
      };

      const Projects = ({ onOpenProject }) => {
        return (
          <section id="projects" className="py-24 px-4 sm:px-6 lg:px-8 relative bg-void overflow-hidden">
            <div className="absolute inset-0 z-0 bg-stars opacity-40"></div>
            <div className="absolute top-0 right-0 w-[600px] h-[600px] bg-secondary/20 blur-[130px] rounded-full pointer-events-none"></div>
            <div className="absolute bottom-0 left-0 w-[700px] h-[700px] bg-primary/10 blur-[130px] rounded-full pointer-events-none"></div>
            <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[800px] h-[800px] bg-purple-900/10 blur-[150px] rounded-full pointer-events-none"></div>

            <div className="relative z-10 mx-auto max-w-6xl">
              <div className="flex items-end justify-between mb-16 border-b border-white/10 pb-6">
                <div>
                  <span className="text-secondary font-mono text-sm tracking-widest mb-2 block">SELECTED WORKS</span>
                  <h2 className="text-3xl font-bold text-white sm:text-4xl">Exploration Log</h2>
                </div>
                <a href="#" className="hidden sm:flex items-center gap-2 text-sm font-medium text-slate-400 hover:text-secondary transition-colors">
                  Full Archive <span className="material-symbols-outlined text-[16px]">arrow_forward</span>
                </a>
              </div>

              <div className="grid grid-cols-1 gap-10 md:grid-cols-2 lg:grid-cols-3">
                {PROJECTS.map((project, idx) => (
                  <div 
                    key={idx} 
                    onClick={() => {
                        if (project.id === 'molecular') {
                            onOpenProject(project.id);
                        } else {
                            // Feedback for unimplemented projects
                            alert("Access Denied: Classified Information. \n(This project link is a placeholder for the demo)");
                        }
                    }}
                    className={`group relative cursor-pointer overflow-hidden rounded-xl bg-[#0a0f14] border border-white/5 transition-all duration-300 hover:-translate-y-2 hover:border-${project.color === 'primary' ? 'primary' : 'secondary'}/50 hover:shadow-neon${project.color !== 'primary' ? '-purple' : ''}`}
                  >
                    <div className="aspect-[4/3] w-full overflow-hidden relative">
                      <div 
                        className="h-full w-full bg-cover bg-center transition-transform duration-700 group-hover:scale-110"
                        style={{ 
                          backgroundImage: `url('${project.image}')`,
                          filter: project.title.includes('Curiosity') ? 'contrast(1.2) hue-rotate(220deg) saturate(0.8)' : 
                                  project.title.includes('Molecular') ? 'grayscale(100%) brightness(0.8) contrast(1.2)' : 
                                  'hue-rotate(45deg) contrast(1.1)' 
                        }}
                      >
                        <div className="absolute inset-0 bg-gradient-to-t from-[#0a0f14] via-transparent to-transparent opacity-90"></div>
                      </div>
                      <div className={`absolute top-4 right-4 bg-${project.color === 'primary' ? 'primary' : 'purple-500'}/20 backdrop-blur-md border border-${project.color === 'primary' ? 'primary' : 'purple-500'}/30 text-${project.color === 'primary' ? 'primary' : 'purple-300'} text-xs font-bold px-3 py-1 rounded-full`}>
                        {project.category}
                      </div>
                    </div>
                    
                    <div className="absolute bottom-0 left-0 w-full p-6">
                      <h3 className={`text-xl font-bold text-white group-hover:text-${project.color} transition-colors`}>{project.title}</h3>
                      <p className="mt-2 text-sm text-slate-400 line-clamp-2">{project.description}</p>
                      <div className="mt-4 flex gap-2">
                        {project.tags.map(tag => (
                          <span key={tag} className="text-[10px] uppercase tracking-wider text-slate-500 font-mono">{tag}</span>
                        ))}
                      </div>
                    </div>
                  </div>
                ))}
              </div>
            </div>
          </section>
        );
      };

      const About = () => {
        return (
          <section id="about" className="py-24 px-4 sm:px-6 lg:px-8 bg-[#050505] relative overflow-hidden">
            <div className="absolute top-0 right-0 w-[400px] h-[400px] bg-primary/10 blur-[100px] rounded-full pointer-events-none"></div>
            <div className="absolute bottom-0 left-0 w-[400px] h-[400px] bg-secondary/10 blur-[100px] rounded-full pointer-events-none"></div>
            <div className="absolute top-0 left-1/2 -translate-x-1/2 w-px h-24 bg-gradient-to-b from-transparent to-slate-800"></div>
            <div className="mx-auto max-w-4xl relative z-10">
              <div className="mb-16 text-center">
                <h2 className="text-3xl font-bold text-white sm:text-4xl"><span className="text-primary">Tech</span> & <span className="text-secondary">Science</span> Stack</h2>
              </div>
              <div className="grid grid-cols-1 md:grid-cols-2 gap-16 items-center">
                <div className="space-y-6 order-2 md:order-1">
                  <h3 className="text-xl font-bold text-white flex items-center gap-2"><span className="material-symbols-outlined text-secondary">science</span> Scientific Methodology</h3>
                  <p className="text-slate-400 leading-relaxed">I am driven by an unyielding curiosity to understand the mechanisms of our universe. I treat every project with extreme patience and carefulness, ensuring that every detail is accounted for.</p>
                  <div className="pt-4"><a href="#" className="inline-flex items-center text-white border-b border-primary pb-1 hover:text-primary transition-colors font-medium">Analyze Resume <span className="material-symbols-outlined ml-2 text-lg">download</span></a></div>
                </div>
                <div className="grid grid-cols-2 gap-4 order-1 md:order-2">
                  {TECH_STACK.map((tech) => (
                    <div key={tech.title} className={`bg-surface-dark/50 backdrop-blur-sm p-5 rounded-lg border border-slate-800 hover:border-${tech.color.includes('primary') ? 'primary' : 'secondary'} transition-all group`}>
                      <span className={`material-symbols-outlined ${tech.color} mb-3 text-3xl group-hover:scale-110 transition-transform`}>{tech.icon}</span>
                      <h4 className="text-white font-bold text-sm uppercase tracking-wider">{tech.title}</h4>
                      <p className="text-xs text-slate-500 mt-1 font-mono">{tech.desc}</p>
                    </div>
                  ))}
                </div>
              </div>
            </div>
          </section>
        );
      };

      const Contact = () => {
        return (
           <section id="contact" className="py-32 px-4 sm:px-6 relative overflow-hidden bg-void">
            <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 h-[400px] w-[400px] bg-secondary/10 blur-[100px] rounded-full"></div>
            <div className="absolute top-0 w-full h-px bg-gradient-to-r from-transparent via-secondary/50 to-transparent"></div>
            <div className="mx-auto max-w-2xl text-center relative z-10">
              <h2 className="text-4xl font-black text-white mb-6 sm:text-6xl tracking-tighter">Signal Received?</h2>
              <p className="text-lg text-slate-400 mb-12 font-light">Ready to collaborate on the next frontier of web design? <br className="hidden sm:block"/> My frequency is open for new opportunities.</p>
              <div className="flex flex-col sm:flex-row gap-6 justify-center">
                <a href="mailto:nguyennhathanhhuy@gmail.com" className="flex items-center justify-center gap-3 bg-[#0a0f14] hover:bg-[#131b24] border border-slate-800 hover:border-secondary text-white px-8 py-4 rounded-lg transition-all group shadow-lg hover:shadow-neon-purple"><span className="material-symbols-outlined text-secondary group-hover:animate-pulse">mail</span><span className="font-medium tracking-wide">nguyennhathanhhuy@gmail.com</span></a>
                <div className="flex gap-4 justify-center items-center">{['GitHub', 'LinkedIn'].map((platform) => (<a key={platform} href="#" className={`h-14 w-14 flex items-center justify-center rounded-lg bg-[#0a0f14] border border-slate-800 text-slate-400 hover:text-white hover:border-${platform === 'GitHub' ? 'primary' : 'secondary'} hover:shadow-${platform === 'GitHub' ? 'neon' : 'neon-purple'} transition-all`} aria-label={platform}><span className="material-symbols-outlined">{platform === 'GitHub' ? 'code_blocks' : 'person_search'}</span></a>))}</div>
              </div>
            </div>
          </section>
        );
      };

      const Footer = () => {
        return (
          <footer className="border-t border-white/5 bg-void py-10 px-6 text-center">
            <p className="text-slate-600 text-sm font-mono">&copy; 2024 Thanh Huy. <span className="text-slate-700 mx-2">|</span> Built in the void with <span className="text-secondary"></span> and Tailwind CSS.</p>
          </footer>
        );
      };

      const App = () => {
        const [activeProject, setActiveProject] = useState(null);

        return (
          <main className="relative flex min-h-screen w-full flex-col">
            <Navbar />
            <Hero />
            <Projects onOpenProject={setActiveProject} />
            <About />
            <Contact />
            <Footer />

            {/* Overlays */}
            {activeProject === 'molecular' && (
                <MolecularViewer onClose={() => setActiveProject(null)} />
            )}
          </main>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
  </body>
</html>